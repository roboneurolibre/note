
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>2020 T1 Reproducibility Challenge</title>
    
  <!-- Loaded before other Sphinx assets -->
  <link href="_static/styles/theme.css?digest=1999514e3f237ded88cf" rel="stylesheet">
<link href="_static/styles/pydata-sphinx-theme.css?digest=1999514e3f237ded88cf" rel="stylesheet">

    
  <link rel="stylesheet"
    href="_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    <link rel="stylesheet" type="text/css" href="_static/pygments.css" />
    <link rel="stylesheet" href="_static/styles/sphinx-book-theme.css?digest=5115cc725059bd94278eecd172e13a965bf8f5a9" type="text/css" />
    <link rel="stylesheet" type="text/css" href="_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="_static/custom.css" />
    <link rel="stylesheet" type="text/css" href="_static/custom.css" />
    <link rel="stylesheet" type="text/css" href="_static/custom.css" />
    <link rel="stylesheet" type="text/css" href="_static/design-style.b7bb847fb20b106c3d81b95245e65545.min.css" />
    
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf">

    <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
    <script src="_static/jquery.js"></script>
    <script src="_static/underscore.js"></script>
    <script src="_static/doctools.js"></script>
    <script src="_static/clipboard.min.js"></script>
    <script src="_static/copybutton.js"></script>
    <script src="_static/scripts/sphinx-book-theme.js?digest=9c920249402e914e316237a7dbc6769907cce411"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="_static/togglebutton.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script src="_static/design-tabs.js"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"
const thebe_selector = ".thebe,.cell"
const thebe_selector_input = "pre"
const thebe_selector_output = ".output, .cell_output"
</script>
    <script async="async" src="_static/sphinx-thebe.js"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"
const thebe_selector = ".thebe,.cell"
const thebe_selector_input = "pre"
const thebe_selector_output = ".output, .cell_output"
</script>
    <script async="async" src="_static/sphinx-thebe.js"></script>
    <script>window.MathJax = {"options": {"processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="None">
    

    <!-- Google Analytics -->
    
  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="60">
<!-- Checkboxes to toggle the left sidebar -->
<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation" aria-label="Toggle navigation sidebar">
<label class="overlay overlay-navbar" for="__navigation">
    <div class="visually-hidden">Toggle navigation sidebar</div>
</label>
<!-- Checkboxes to toggle the in-page toc -->
<input type="checkbox" class="sidebar-toggle" name="__page-toc" id="__page-toc" aria-label="Toggle in-page Table of Contents">
<label class="overlay overlay-pagetoc" for="__page-toc">
    <div class="visually-hidden">Toggle in-page Table of Contents</div>
</label>
<!-- Headers at the top -->
<div class="announcement header-item noprint"></div>
<div class="header header-item noprint"></div>

    
    <div class="container-fluid" id="banner"></div>

    

    <div class="container-xl">
      <div class="row">
          
<!-- Sidebar -->
<div class="bd-sidebar noprint single-page" id="site-navigation">
</div>


          


          
<!-- A tiny helper pixel to detect if we've scrolled -->
<div class="sbt-scroll-pixel-helper"></div>
<!-- Main content -->
<div class="col py-0 content-container">
    
    <div class="header-article row sticky-top noprint">
        



<div class="col py-1 d-flex header-article-main">
    <div class="header-article__left">
        
    </div>
    <div class="header-article__right">
<div class="menu-dropdown menu-dropdown-launch-buttons">
  <button class="headerbtn menu-dropdown__trigger"
      aria-label="Launch interactive content">
      <i class="fas fa-rocket"></i>
  </button>
  <div class="menu-dropdown__content">
    <ul>
      <li>
        <a href="https://mybinder.org/v2/gh/rrsg2020/paper/main?urlpath=lab/tree/content/index.ipynb"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Launch on Binder"
>
  

<span class="headerbtn__icon-container">
  
    <img src="_static/images/logo_binder.svg">
  </span>
<span class="headerbtn__text-container">Binder</span>
</a>

      </li>
      
    </ul>
  </div>
</div>

<button onclick="toggleFullScreen()"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="bottom"
title="Fullscreen mode"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>

    </div>
</div>

<!-- Table of contents -->
<div class="col-md-3 bd-toc show noprint">
</div>
    </div>
    <div class="article row">
        <div class="col pl-md-3 pl-lg-5 content-container">
            <!-- Table of contents that is only displayed when printing the page -->
            <div id="jb-print-docs-body" class="onlyprint">
                <h1>Abstract</h1>
                <!-- Table of contents -->
                <div id="print-main-content">
                    <div id="jb-print-toc">
                        
                    </div>
                </div>
            </div>
            <main id="main-content" role="main">
                
              <div>
                
  <div class="cell tag_remove_output tag_remove_input docutils container">
</div>
<head>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=STIX+Two+Text:ital,wght@0,400;0,700;1,400&display=swap" rel="stylesheet">
</head>
<p>
<center>
<b>
<h3>
A PDF is not enough: Crowdsourcing the T<sub>1</sub> mapping common ground via the ISMRM reproducibility challenge
</h3>
<p>
<sup>*</sup>Mathieu Boudreau<sup>1,2</sup>, <sup>*</sup>Agah Karakuzu<sup>1</sup>, Julien Cohen-Adad<sup>1,3,4,5</sup>, Ecem Bozkurt<sup>6</sup>, Madeline Carr<sup>7,8</sup>, Marco Castellaro<sup>9</sup>, Luis Concha<sup>10</sup>, Mariya Doneva<sup>11</sup>, Seraina Dual<sup>12</sup>, Alex Ensworth<sup>13,14</sup>, Alexandru Foias<sup>1</sup>, Véronique Fortier<sup>15,16</sup>, Refaat E. Gabr<sup>17</sup>, Guillaume Gilbert<sup>18</sup>, Carri K. Glide-Hurst<sup>19</sup>, Matthew Grech-Sollars<sup>20,21</sup>, Siyuan Hu<sup>22</sup>, Oscar Jalnefjord<sup>23,24</sup>, Jorge Jovicich<sup>25</sup>, Kübra Keskin<sup>6</sup>, Peter Koken<sup>11</sup>, Anastasia Kolokotronis<sup>13,26</sup>, Simran Kukran<sup>27,28</sup>, Nam. G. Lee<sup>6</sup>, Ives R. Levesque<sup>13,29</sup>, Bochao Li<sup>6</sup>, Dan Ma<sup>22</sup>, Burkhard Mädler<sup>30</sup>, Nyasha Maforo<sup>31,32</sup>, Jamie Near<sup>33,34</sup>, Erick Pasaye<sup>10</sup>, Alonso Ramirez-Manzanares<sup>35</sup>, Ben Statton<sup>36</sup>,Christian Stehning<sup>30</sup>, Stefano Tambalo<sup>25</sup>, Ye Tian<sup>6</sup>, Chenyang Wang<sup>37</sup>, Kilian Weiss<sup>30</sup>, Niloufar Zakariaei<sup>38<sup>, Shuo Zhang<sup>30</sup>, Ziwei Zhao<sup>6</sup>, Nikola Stikov<sup>1,2,39</sup>
</p>
</b>
<ul style="list-style-type: none">
<li><sup>*</sup>Authors MB and AK contributed equally to this work</li>
</ul>
</center>
<p style="text-align:justify;font-size:70%">
<sup>1</sup>NeuroPoly Lab, Polytechnique Montréal, Montreal, Quebec, Canada,
<sup>2</sup>Montreal Heart Institute, Montreal, Quebec, Canada,
<sup>3</sup>Unité de Neuroimagerie Fonctionnelle (UNF), Centre de recherche de l’Institut Universitaire de Gériatrie de Montréal (CRIUGM), Montreal, Quebec, Canada,
<sup>4</sup>Mila - Quebec AI Institute, Montreal, QC, Canada,
<sup>5</sup>Centre de recherche du CHU Sainte-Justine, Université de Montréal, Montreal, QC, Canada,
<sup>6</sup>Magnetic Resonance Engineering Laboratory (MREL), University of Southern California, Los Angeles, California, USA,
<sup>7</sup>Medical Physics, Ingham Institute for Applied Medical Research, Liverpool, Australia,
<sup>8</sup>Department of Medical Physics, Liverpool and Macarthur Cancer Therapy Centres, Liverpool, Australia,
<sup>9</sup>Department of Information Engineering, University of Padova, Padova, Italy,
<sup>10</sup>Institute of Neurobiology, Universidad Nacional Autónoma de México Campus Juriquilla, Querétaro, México,
<sup>11</sup>Philips Research Hamburg, Germany,
<sup>12</sup>Stanford University, Stanford, California, United States,
<sup>13</sup>Medical Physics Unit, McGill University, Montreal, Canada,
<sup>14</sup>University of British Columbia, Vancouver, Canada,
<sup>15</sup>Department of Medical Imaging, McGill University Health Centre, Montreal, Quebec, Canada
<sup>16</sup>Department of Radiology, McGill University, Montreal, Quebec, Canada,
<sup>17</sup>Department of Diagnostic and Interventional Imaging, University of Texas Health Science Center at Houston, McGovern Medical School, Houston, Texas, USA, 
<sup>18</sup>MR Clinical Science, Philips Canada, Mississauga, Ontario, Canada,
<sup>19</sup>Department of Human Oncology, University of Wisconsin-Madison, Madison, Wisconsin, USA,
<sup>20</sup>Centre for Medical Image Computing, Department of Computer Science, University College London, London, UK,
<sup>21</sup>Lysholm Department of Neuroradiology, National Hospital for Neurology and Neurosurgery, University College London Hospitals NHS Foundation Trust, London, UK,
<sup>22</sup>Department of Biomedical Engineering, Case Western Reserve University, Cleveland, Ohio, USA, 
<sup>23</sup>Department of Medical Radiation Sciences, Institute of Clinical Sciences, Sahlgrenska Academy, University of Gothenburg, Gothenburg, Sweden,
<sup>24</sup>Biomedical Engineering, Sahlgrenska University Hospital, Gothenburg, Sweden, 
<sup>25</sup>Center for Mind/Brain Sciences, University of Trento, Italy,
<sup>26</sup>Hopital Maisonneuve-Rosemont, Montreal, Canada,
<sup>27</sup>Bioengineering, Imperial College London, UK,
<sup>28</sup>Radiotherapy and Imaging, Insitute of Cancer Research, Imperial College London, UK,
<sup>29</sup>Research Institute of the McGill University Health Centre, Montreal, Canada,
<sup>30</sup>Clinical Science, Philips Healthcare, Germany,
<sup>31</sup>Department of Radiological Sciences, University of California Los Angeles, Los Angeles, CA, USA,
<sup>32</sup>Physics and Biology in Medicine IDP, University of California Los Angeles, Los Angeles, CA, USA,
<sup>33</sup>Douglas Brain Imaging Centre, Montreal, Canada,
<sup>34</sup>Sunnybrook Research Institute, Toronto, Canada,
<sup>35</sup>Computer Science Department, Centro de Investigación en Matemáticas, A.C., Guanajuato, México,
<sup>36</sup>Medical Research Council, London Institute of Medical Sciences, Imperial College London, London, United Kingdom,
<sup>37</sup>Department of Radiation Oncology - CNS Service, The University of Texas MD Anderson Cancer Center, Texas, USA,
<sup>38</sup>Department of Biomedical Engineering, University of British Columbia, British Columbia, Canada,
<sup>39</sup>Center for Advanced Interdisciplinary Research, Ss. Cyril and Methodius University, Skopje, North Macedonia
</p>
</p><div class="tex2jax_ignore mathjax_ignore section" id="abstract">
<h1>Abstract<a class="headerlink" href="#abstract" title="Permalink to this headline">#</a></h1>
<p><strong>Purpose:</strong> T1 mapping is a widely used quantitative MRI technique, but its tissue-specific values remain inconsistent across protocols, sites, and vendors. The ISMRM Reproducible Research study group (RRSG) and Quantitative MR study group (qMRSG) jointly launched a T1 mapping reproducibility challenge to assess the reproducibility of a well-established inversion recovery T1 mapping technique, published solely as a PDF, on a standardized phantom and in healthy human brains.</p>
<p><strong>Methods:</strong> The challenge used the acquisition protocol and fitting algorithm from Barral et al. 2010. Participants collected T1 mapping data on the ISMRM/NIST phantom and/or in healthy human brains. Data submission, pipeline development, and analysis were conducted using open-source platforms. Inter-submission and intra-submission comparisons were performed using one dataset per submission.</p>
<p><strong>Results:</strong> Eighteen submissions were accepted using data collected with three MRI manufacturers, primarily at 3T (with one submission at 0.35T). The study collected 39 phantom and 56 human datasets. The mean coefficient of variation (CoV) was 6.1% for inter-submission phantom measurements, which was nearly twice as high as the intra-submission CoV (2.9%). For human data, inter-/intra-submission CoV was 5.9/3.2 % in the genu of the corpus callosum and 16/6.9 % in the cortical gray matter. To facilitate broader community access and engagement, an interactive dashboard was developed and is available at<a href = "https://rrsg2020.dashboards.neurolibre.org">https://rrsg2020.dashboards.neurolibre.org</a>.</p>
<p><strong>Conclusion:</strong> The inter-submission variability was twice as high as the intra-submission variability in both phantom and human brain T1 measurements, indicating that the published PDF was not sufficient to reproduce a quantitative MRI protocol.</p>
<h2 style="display:inline"><center> Dashboard: Challenge Submissions </center></h2>
<iframe src="https://rrsg2020.dashboards.neurolibre.org" width="120%" height="750px" style="border:none;margin: 0 -10%"></iframe>
<p></p></div>
<div class="tex2jax_ignore mathjax_ignore section" id="introduction">
<h1>1     |     INTRODUCTION<a class="headerlink" href="#introduction" title="Permalink to this headline">#</a></h1>
<p>Significant challenges exist in the reproducibility of quantitative MRI (qMRI) [1]. Despite its promise of improving the specificity and reproducibility of MRI acquisitions, few qMRI techniques have been integrated into clinical practice. Even the most fundamental MR parameters cannot be measured with sufficient reproducibility and precision across clinical scanners to pass the second of six stages of technical assessment for clinical biomarkers [2–4]. Half a century has passed since the first quantitative T1 (spin-lattice relaxation time) measurements were first reported as a potential biomarker for tumors [5], followed shortly thereafter by the first in vivo T1 maps [6] of tumors, but there is still disagreement in reported values for this fundamental parameter across different sites, vendors, and implementations [7].</p>
<p>Among fundamental MRI parameters, T1 holds significant importance [8]. T1 represents the time constant for recovery of equilibrium longitudinal magnetization. T1 values will vary depending on the molecular mobility and magnetic field strength [9–11]. Knowledge of the T1 values for tissue is crucial for optimizing clinical MRI sequences for contrast and time efficiency [12–14] and to calibrate other  quantitative MRI techniques [15,16]. Inversion recovery (IR) [17,18] is considered the gold standard for T1 measurement due to its robustness, but its long acquisition times limit the clinical use of IR for T1 mapping [7]. In practice, IR is often used as a reference for validating other T1 mapping techniques, such as variable flip angle imaging (VFA) [19–21], Look-Locker [22–24], and MP2RAGE [25,26].</p>
<p>In ongoing efforts to standardize T1 mapping methods, researchers have been actively developing quantitative MRI phantoms [27]. The International Society for Magnetic Resonance in Medicine (ISMRM) and the National Institute of Standards and Technology (NIST) collaborated on a standard system phantom [28], which was subsequently commercialized (Premium System Phantom, CaliberMRI, Boulder, Colorado). This phantom has since been used in large multicenter studies, such as Bane et al. [29] which concluded that acquisition protocol and field strength influence accuracy, repeatability, and interplatform reproducibility. Another NIST-led study [30] found no significant T1 discrepancies among measurements using NIST protocols across 27 MRI systems from three vendors at two clinical field strengths.</p>
<p>The 2020 ISMRM reproducibility challenge  posed the following question: can an imaging protocol, independently implemented at multiple centers, consistently measure one of the fundamental MRI parameters (T1)? To assess this, we proposed using inversion recovery on a standardized phantom (ISMRM/NIST system phantom) and the healthy human brain. Specifically, <strong>this challenge explored whether the information provided in a published PDF of a seminal paper on T1 mapping [31] is sufficient to ensure the reproducibility across independent research imaging groups.</strong></p>
</div>
<div class="tex2jax_ignore mathjax_ignore section" id="methods">
<h1>2     |     METHODS<a class="headerlink" href="#methods" title="Permalink to this headline">#</a></h1>
<div class="section" id="phantom-and-human-data">
<h2>2.1     |     Phantom and human data<a class="headerlink" href="#phantom-and-human-data" title="Permalink to this headline">#</a></h2>
<p>The challenge asked participants with access to the ISMRM/NIST system phantom [28] (Premium System Phantom, CaliberMRI, Boulder, Colorado) to measure T1 maps of the phantom’s T1 plate (Table 1). Researchers that  participated in the challenge were instructed to record the temperature before and after scanning the phantom using the phantom’s internal thermometer. Instructions for positioning and setting up the phantom were devised by NIST and were provided to participants through their website . In brief, the instructions explained how to orient the phantom and how long the phantom should be in the scanner room prior to scanning to achieve thermal equilibrium.</p>
<table class="docutils align-default" id="table1">
<caption><span class="caption-number">Table 1 </span><span class="caption-text">Reference  T1 values of the NiCl2 array of the standard system phantom (for both phantom versions) measured at 20 °C and 3T. Phantoms with serial numbers 0042 or less are referred to as “Version 1”, and those 0043 or greater are “Version 2”.</span><a class="headerlink" href="#table1" title="Permalink to this table">#</a></caption>
<colgroup>
<col style="width: 33%" />
<col style="width: 33%" />
<col style="width: 33%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Sphere</p></th>
<th class="head"><p>Version 1 (ms)</p></th>
<th class="head"><p>Version 2 (ms)</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>1</p></td>
<td><p>1989 ± 1.0</p></td>
<td><p>1883.97 ± 30.32</p></td>
</tr>
<tr class="row-odd"><td><p>2</p></td>
<td><p>1454 ± 2.5</p></td>
<td><p>1330.16 ± 20.41</p></td>
</tr>
<tr class="row-even"><td><p>3</p></td>
<td><p>984.1 ± 0.33</p></td>
<td><p>987.27 ± 14.22</p></td>
</tr>
<tr class="row-odd"><td><p>4</p></td>
<td><p>706 ± 1.0</p></td>
<td><p>690.08 ± 10.12</p></td>
</tr>
<tr class="row-even"><td><p>5</p></td>
<td><p>496.7 ± 0.41</p></td>
<td><p>484.97 ± 7.06</p></td>
</tr>
<tr class="row-odd"><td><p>6</p></td>
<td><p>351.5 ± 0.91</p></td>
<td><p>341.58 ± 4.97</p></td>
</tr>
<tr class="row-even"><td><p>7</p></td>
<td><p>247.13 ± 0.086</p></td>
<td><p>240.86 ± 3.51</p></td>
</tr>
<tr class="row-odd"><td><p>8</p></td>
<td><p>175.3 ± 0.11</p></td>
<td><p>174.95 ± 2.48</p></td>
</tr>
<tr class="row-even"><td><p>9</p></td>
<td><p>125.9 ± 0.33</p></td>
<td><p>121.08 ± 1.75</p></td>
</tr>
<tr class="row-odd"><td><p>10</p></td>
<td><p>89.0 ± 0.17</p></td>
<td><p>85.75 ± 1.24</p></td>
</tr>
<tr class="row-even"><td><p>11</p></td>
<td><p>62.7 ± 0.13</p></td>
<td><p>60.21 ± 0.87</p></td>
</tr>
<tr class="row-odd"><td><p>12</p></td>
<td><p>44.53 ± 0.090</p></td>
<td><p>42.89 ± 0.44</p></td>
</tr>
<tr class="row-even"><td><p>13</p></td>
<td><p>30.84 ± 0.016</p></td>
<td><p>30.40 ± 0.62</p></td>
</tr>
<tr class="row-odd"><td><p>14</p></td>
<td><p>21.719 ± 0.005</p></td>
<td><p>21.44 ± 0.31</p></td>
</tr>
</tbody>
</table>
<p>Participants were also instructed to collect T1 maps in healthy human brains, and were asked to measure a single slice positioned parallel to the anterior commissure - posterior commissure (AC-PC) line. Prior to imaging, the participants consented  to share their de-identified data with the challenge organizers and on the Open Science Framework (<a class="reference external" href="http://OSF.io">OSF.io</a>) website. As the submitted data was a single slice, the researchers were not instructed to de-face the data of their participants. Researchers submitting human data provided written confirmation to the organizers that their data was acquired in accordance with their institutional ethics committee (or equivalent regulatory body) and that the subjects had consented to data sharing as outlined in the challenge.</p>
</div>
<div class="section" id="mri-acquisition-protocol">
<h2>2.2     |     MRI acquisition protocol<a class="headerlink" href="#mri-acquisition-protocol" title="Permalink to this headline">#</a></h2>
<p>Participants followed the inversion recovery T1 mapping protocol optimized for the human brain as described in the published PDF [31], which consisted of: TR = 2550 ms, TIs = 50, 400, 1100, 2500 ms, TE = 14 ms, 2 mm slice thickness and 1×1 mm2 in-plane resolution. Note that this protocol is not suitable for fitting models that assume TR &gt; 5T1. Instead, the more general Barral et al. [31] fitting model described in Section 2.4.1 can be used, and this model is compatible with both magnitude-only and complex data. Researchers were instructed to closely adhere to this protocol and report any deviations due to technical limitations.</p>
</div>
<div class="section" id="data-submissions">
<h2>2.3     |     Data Submissions<a class="headerlink" href="#data-submissions" title="Permalink to this headline">#</a></h2>
<p>Data submissions for the challenge were handled through a GitHub repository <a class="reference external" href="https://github.com/rrsg2020/data_submission">https://github.com/rrsg2020/data_submission</a>, enabling a standardized and transparent process. All datasets were converted to the NIfTI format, and images for all TIs were concatenated along the fourth dimension. Each submission included a YAML file to store additional information (submitter details, acquisition details, and phantom or human subject details). Submissions were reviewed, and following acceptance the datasets were uploaded to <a class="reference external" href="http://OSF.io">OSF.io</a> (<span class="xref myst">osf.io/ywc9g/</span>). A Jupyter Notebook [32,33] pipeline using qMRLab [34,35] was used to process the T1 maps and to conduct quality-control checks. MyBinder links to Jupyter notebooks that reproduced each T1 map were shared in each respective submission GitHub issue to easily reproduce the results in web browsers while maintaining consistent computational environments. Eighteen submissions were included in the analysis, which resulted in 39 T1 maps of the NIST/system phantom, and 56 brain T1 maps. Figure 1 illustrates all the submissions that acquired phantom data (Figure 1-a) and human data (Figure 1-b), the MRI scanner vendors, and the resulting T1 mapping datasets. Some submissions included measurements where both complex and magnitude-only data from the same acquisition were used to fit T1 maps, thus the total number of unique acquisitions is lower than the numbers reported above (27 for phantom data and 44 for human data). The datasets were collected on systems from three MRI manufacturers (Siemens, GE, Philips) and were acquired at 3T , except for one dataset acquired at 0.35T (the ViewRay MRidian MR-linac).</p>
<a class="reference internal image-reference" href="_images/figure_1.png" id="fig1"><img alt="_images/figure_1.png" class="align-center" id="fig1" src="_images/figure_1.png" style="width: 900px;" /></a>
</div>
<div class="section" id="fitting-model-and-pipeline">
<h2>2.4     |     Fitting Model and Pipeline<a class="headerlink" href="#fitting-model-and-pipeline" title="Permalink to this headline">#</a></h2>
<p>A reduced-dimension non-linear least squares (RD-NLS) approach was used to fit the complex general inversion recovery signal equation:</p>
<div class="math notranslate nohighlight" id="equation-my-label">
<span class="eqno">(1)<a class="headerlink" href="#equation-my-label" title="Permalink to this equation">#</a></span>\[S(TI) = a + be^{-TI/T_1}\]</div>
<p>where a and b are complex constants. This approach, developed by Barral et al. [31], offers a model for the general T1 signal equation without relying on the long-TR approximation. The a and b constants inherently factor TR in them, as well as other imaging parameters such as excitation and inversion pulse flip angles, TE, etc. Barral et al. [31] shared their MATLAB (MathWorks, Natick, MA) code for the fitting algorithm used in their paper . Magnitude-only data were fitted to a modified version of Eq. 1 (Eq. 15 of Barral et al. 2010) with signal-polarity restoration by finding the signal minima, fitting the inversion recovery curve for two cases (data points for TI &lt; TIminimum flipped, and data points for TI ≤ TIminimum flipped), and selecting the case that resulted in the best fit. This code is available as part of the open-source software qMRLab [34,35], which provides a standardized application program interface (API) to call the fitting in MATLAB/Octave scripts.</p>
<p>A data processing pipeline was written using MATLAB/Octave in a Jupyter Notebook. This pipeline downloads every dataset from <a class="reference external" href="http://osf.io">osf.io</a> (<a class="reference external" href="http://osf.io/ywc9g/">osf.io/ywc9g/</a>), loads their configuration file, fits the T1 maps, and then saves them to NIfTI and PNG formats. The code is available on GitHub (<a class="reference external" href="https://github.com/rrsg2020/t1_fitting_pipeline">https://github.com/rrsg2020/t1_fitting_pipeline</a>, filename: RRSG_T1_fitting.ipynb). Finally, T1 maps were manually uploaded to OSF (<a class="reference external" href="https://osf.io/ywc9g/">https://osf.io/ywc9g/</a>).</p>
</div>
<div class="section" id="image-labeling-registration">
<h2>2.5     |     Image Labeling &amp; Registration<a class="headerlink" href="#image-labeling-registration" title="Permalink to this headline">#</a></h2>
<p>The T1 plate (NiCl2 array) of the phantom has 14 spheres that were labeled as the regions-of-interest (ROI) using a numerical mask template created in MATLAB, provided by NIST researchers (Figure 1-c). To avoid potential edge effects in the T1 maps, the ROI labels were reduced to 60% of the expected sphere diameter. A registration pipeline in Python using the Advanced Normalization Tools (ANTs) [36] was developed and shared in the analysis repository of our GitHub organization (<a class="reference external" href="https://github.com/rrsg2020/analysis">https://github.com/rrsg2020/analysis</a>, filename: register_t1maps_nist.py, commit ID: 8d38644). Briefly, a label-based registration was first applied to obtain a coarse alignment, followed by an affine registration (gradientStep: 0.1, metric: cross correlation, number of steps: 3, iterations: 100/100/100, smoothness: 0/0/0, sub-sampling: 4/2/1) and a BSplineSyN registration (gradientStep:0.5, meshSizeAtBaseLevel:3, number of steps: 3, iterations: 50/50/10, smoothness: 0/0/0, sub-sampling: 4/2/1). The ROI labels template was nonlinearly registered to each T1 map uploaded to OSF.</p>
<p>For human data, manual ROIs were segmented by a single researcher (M.B., 11+ years of neuroimaging experience) using FSLeyes [37] in four regions (Figure 1-d): located in the genu, splenium, deep gray matter, and cortical gray matter. Automatic segmentation was not used because the data were single-slice and there was inconsistent slice positioning between datasets.</p>
<div class="section" id="analysis-and-statistics">
<h3>2.6     |     Analysis and Statistics<a class="headerlink" href="#analysis-and-statistics" title="Permalink to this headline">#</a></h3>
<p>Analysis code and scripts were developed and shared in a version-controlled public GitHub repository . The T1 fitting and data analysis were performed by M.B., one of the challenge organizers. Computational environment requirements were containerized in Docker [38,39] to create an executable environment that allows for analysis reproduction in a web browser via MyBinder  [40]. Backend Python files handled reference data, database operations, ROI masking, and general analysis tools. Configuration files handled dataset information, and the datasets were downloaded and pooled using a script (make_pooled_datasets.py). The databases were created using a reproducible Jupyter Notebook script and subsequently saved in the repository.</p>
<p>The mean T1 values of the ISMRM/NIST phantom data for each ROI were compared with temperature-corrected reference values and visualized in three different types of plots (linear axes, log-log axes, and error relative to the reference value). Temperature correction involved nonlinear interpolation  of a NIST reference table of T1 values for temperatures ranging from 16 °C to 26 °C (2 °C intervals) as specified in the phantom’s technical specifications. For the human datasets, the mean and standard deviations for each tissue ROI were calculated from all submissions across all sites. All quality assurance and analysis plot images were stored in the repository. Additionally, the database files of ROI values and acquisition details for all submissions were also stored in the repository.</p>
</div>
<div class="section" id="dashboard">
<h3>2.7     |     Dashboard<a class="headerlink" href="#dashboard" title="Permalink to this headline">#</a></h3>
<p>To widely disseminate the challenge results, a web-based dashboard was developed (Figure 2, <a class="reference external" href="https://rrsg2020.dashboards.neurolibre.org">https://rrsg2020.dashboards.neurolibre.org</a>). The landing page (Figure 2-a) showcases the relationship between the phantom and brain datasets acquired at different sites/vendors. Selecting the Phantom or In Vivo icons and then clicking an ROI will display whisker plots for that region. Additional sections of the dashboard allow for displaying statistics summaries for both sets of data, a magnitude vs complex data fitting comparison, and hierarchical shift function analyses.</p>
<iframe src="https://rrsg2020.dashboards.neurolibre.org" width="120%" height="750px" style="border:none;margin: 0 -10%"></iframe><p class="caption">
<b>Figure 2</b> Dashboard. a) Welcome page listing all the sites, the types of subject, and scanner, and the relationship between the three. b) The phantom tab for a selected ROI, and c) The in vivo tab for a selected ROI. Link: https://rrsg2020.dashboards.neurolibre.org
</p></div>
</div>
</div>
<div class="tex2jax_ignore mathjax_ignore section" id="results">
<h1>3     |     RESULTS<a class="headerlink" href="#results" title="Permalink to this headline">#</a></h1>
<p>Figure 3 presents a comprehensive overview of the challenge results through violin plots, depicting inter- and intra- submission comparisons in both phantoms (a) and human (b) datasets. Inter-submission coefficients of variation (CoV) were computed by selecting a single T1 map submitted by each challenge participant  and calculating the CoV. For the phantom (Figure 3-a), the average inter-submission CoV for the first five spheres, representing the expected T1 value range in the human brain (approximately 500 to 2000 ms) was 6.1 %. By addressing outliers from two sites associated with specific challenges for sphere 4 (signal null near a TI), the mean inter-submission CoV reduced to 4.1%. One participant (submission 6, Figure 1) measured T1 maps using a consistent protocol at 7 different sites, and the mean intra-submission CoV across the first five spheres for this submission was calculated to be 2.9 %.</p>
<p>For the human datasets, inter-submission CoVs for independently-implemented imaging protocols were 5.9% for genu, 10.6% for splenium, 16% for cortical GM, and 22% for deep GM. One participant (submission 18, Figure 1) measured a large dataset (13 individuals) on three scanners and two vendors, and the intra-submission CoVs for this submission were 3.2% for genu, 3.1% for splenium, 6.9 % for cortical GM, and 7.1% for deep GM.</p>
<a class="reference internal image-reference" href="_images/figure_3.png" id="fig3"><img alt="_images/figure_3.png" class="align-center" id="fig3" src="_images/figure_3.png" style="width: 900px;" /></a>
<p class="caption">
<b>Figure 3</b> Summary of results of the challenge as violin plots displaying the inter- and intra- submission dataset comparisons for phantoms (a) and human brains (b). Interactive figure available at: https://preprint.neurolibre.org/10.55458/neurolibre.00014/.
</p>
<p>A scatterplot of the T1 data for all submissions and their ROIs is shown in Figure 4 (phantom a-c, and human brains d-f). The NIST T1 data is shown in Figure 4 a-c, and the same ROI T1 values are presented in each plot for different axes types (linear, log, and error) to better visualize the results. Figure 4-a shows good agreement for this dataset in comparison with the temperature-corrected reference T1 values. However, this trend did not persist for low T1 values (T1 &lt; 100-200 ms), as seen in the log-log plot (Figure 4-b), which was expected because the imaging protocol is optimized for human water-based T1 values (T1 &gt; 500 ms). Higher variability is seen at long T1 values (T1 ~ 2000 ms) in Figure 4-a. Errors exceeding 10% are observed in the phantom spheres with T1 values below 300 ms (Figure 4-c), and 3-4 measurements with outlier values exceeding 10% error were observed in the human water-based tissue range (~500-2000 ms).</p>
<p>Figure 4 d-f displays the scatter plot data for human datasets submitted to this challenge, showing mean and standard deviation T1 values from the WM (genu and splenium) and GM (cerebral cortex and deep GM) ROIs. Mean WM T1 values across all submissions were 828 ± 38 ms in the genu and 852 ± 49 ms in the splenium, and mean GM T1 values were 1548 ± 156 ms in the cortex and 1188 ± 133 ms in the deep GM, with less variations overall in WM compared to GM, possibly due to better ROI placement and less partial voluming in WM. The lower standard deviations for the ROIs of human database ID site 9 (submission 18, Figure 1) are due to good slice positioning, cutting through the AC-PC line and the genu for proper ROI placement, particularly for the corpus callosum and deep GM.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">os</span> <span class="kn">import</span> <span class="n">path</span>
<span class="kn">import</span> <span class="nn">os</span>

<span class="k">if</span> <span class="n">build</span> <span class="o">==</span> <span class="s1">&#39;latest&#39;</span><span class="p">:</span>
    <span class="k">if</span> <span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="s1">&#39;analysis&#39;</span><span class="p">)</span><span class="o">==</span> <span class="kc">False</span><span class="p">:</span>
        <span class="o">!</span>git<span class="w"> </span>clone<span class="w"> </span>https://github.com/rrsg2020/analysis.git
        <span class="n">dir_name</span> <span class="o">=</span> <span class="s1">&#39;analysis&#39;</span>
        <span class="n">analysis</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">dir_name</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">analysis</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">item</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s2">&quot;.ipynb&quot;</span><span class="p">):</span>
                <span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">dir_name</span><span class="p">,</span> <span class="n">item</span><span class="p">))</span>
            <span class="k">if</span> <span class="n">item</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s2">&quot;.md&quot;</span><span class="p">):</span>
                <span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">dir_name</span><span class="p">,</span> <span class="n">item</span><span class="p">))</span>
<span class="k">elif</span> <span class="n">build</span> <span class="o">==</span> <span class="s1">&#39;archive&#39;</span><span class="p">:</span>
    <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="n">Path</span><span class="p">(</span><span class="s1">&#39;../../data&#39;</span><span class="p">)):</span>
        <span class="n">data_path</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;../../data/rrsg-2020-neurolibre&#39;</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="c1"># define data requirement path</span>
        <span class="n">data_req_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s2">&quot;..&quot;</span><span class="p">,</span> <span class="s2">&quot;binder&quot;</span><span class="p">,</span> <span class="s2">&quot;data_requirement.json&quot;</span><span class="p">)</span>
        <span class="c1"># download data</span>
        <span class="n">repo2data</span> <span class="o">=</span> <span class="n">Repo2Data</span><span class="p">(</span><span class="n">data_req_path</span><span class="p">)</span>
        <span class="n">data_path</span> <span class="o">=</span> <span class="n">repo2data</span><span class="o">.</span><span class="n">install</span><span class="p">()</span>

<span class="c1"># Imports</span>
<span class="kn">import</span> <span class="nn">warnings</span>
<span class="n">warnings</span><span class="o">.</span><span class="n">filterwarnings</span><span class="p">(</span><span class="s2">&quot;ignore&quot;</span><span class="p">)</span>

<span class="kn">from</span> <span class="nn">pathlib</span> <span class="kn">import</span> <span class="n">Path</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">json</span>
<span class="kn">import</span> <span class="nn">nibabel</span> <span class="k">as</span> <span class="nn">nib</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>

<span class="kn">from</span> <span class="nn">analysis.src.database</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">analysis.src.nist</span> <span class="kn">import</span> <span class="n">get_reference_NIST_values</span><span class="p">,</span> <span class="n">get_NIST_ids</span>
<span class="kn">from</span> <span class="nn">analysis.src.tools</span> <span class="kn">import</span> <span class="n">calc_error</span>
<span class="kn">from</span> <span class="nn">analysis.src.nist</span> <span class="kn">import</span> <span class="n">temperature_correction</span>

<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="n">plt</span><span class="o">.</span><span class="n">style</span><span class="o">.</span><span class="n">use</span><span class="p">(</span><span class="s1">&#39;analysis/custom_matplotlibrc&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s2">&quot;figure.figsize&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">10</span><span class="p">)</span>
<span class="n">fig_id</span> <span class="o">=</span> <span class="mi">0</span>

<span class="k">if</span> <span class="n">build</span> <span class="o">==</span> <span class="s1">&#39;latest&#39;</span><span class="p">:</span>
    <span class="n">database_path</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="s1">&#39;analysis/databases/3T_NIST_T1maps_database.pkl&#39;</span><span class="p">)</span>
    <span class="n">output_folder</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="s2">&quot;analysis/plots/03_singledataset_scatter_NIST-temperature-corrected/&quot;</span><span class="p">)</span>
<span class="k">elif</span> <span class="n">build</span><span class="o">==</span><span class="s1">&#39;archive&#39;</span><span class="p">:</span>
    <span class="n">database_path</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">data_path</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39;/analysis/databases/3T_NIST_T1maps_database.pkl&#39;</span><span class="p">)</span>
    <span class="n">output_folder</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">data_path</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39;/analysis/plots/03_singledataset_scatter_NIST-temperature-corrected/&#39;</span><span class="p">)</span>

<span class="n">estimate_type</span> <span class="o">=</span> <span class="s1">&#39;mean&#39;</span> <span class="c1"># median or mean</span>

<span class="c1">## Define Functions</span>
<span class="k">def</span> <span class="nf">plot_single_scatter</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">y_std</span><span class="p">,</span>
                        <span class="n">title</span><span class="p">,</span> <span class="n">x_label</span><span class="p">,</span> <span class="n">y_label</span><span class="p">,</span>
                        <span class="n">file_prefix</span><span class="p">,</span> <span class="n">folder_path</span><span class="p">,</span> <span class="n">fig_id</span><span class="p">,</span>
                        <span class="n">y_type</span><span class="o">=</span><span class="s1">&#39;linear&#39;</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">y_type</span> <span class="ow">is</span> <span class="s1">&#39;linear&#39;</span><span class="p">:</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">errorbar</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span> <span class="n">y_std</span><span class="p">,</span> <span class="n">fmt</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">,</span> <span class="n">solid_capstyle</span><span class="o">=</span><span class="s1">&#39;projecting&#39;</span><span class="p">)</span>
        <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">axline</span><span class="p">((</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="n">slope</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;dashed&#39;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="n">ymin</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">ymax</span><span class="o">=</span><span class="mi">2500</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="n">xmin</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">xmax</span><span class="o">=</span><span class="mi">2500</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">y_type</span> <span class="ow">is</span> <span class="s1">&#39;log&#39;</span><span class="p">:</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">loglog</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="s1">&#39;o&#39;</span><span class="p">)</span>
        <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="n">ymin</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="n">ymax</span><span class="o">=</span><span class="mi">2500</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="n">xmin</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="n">xmax</span><span class="o">=</span><span class="mi">2500</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">y_type</span> <span class="ow">is</span> <span class="s1">&#39;error_t1&#39;</span><span class="p">:</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">errorbar</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">calc_error</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">),</span> <span class="n">fmt</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">)</span>
        <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">axline</span><span class="p">((</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="n">slope</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">axline</span><span class="p">((</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">10</span><span class="p">),</span> <span class="n">slope</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;dashed&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">axline</span><span class="p">((</span><span class="mi">1</span><span class="p">,</span> <span class="mi">10</span><span class="p">),</span> <span class="n">slope</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;dashed&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="n">ymin</span><span class="o">=-</span><span class="mi">100</span><span class="p">,</span> <span class="n">ymax</span><span class="o">=</span><span class="mi">100</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="n">xmin</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">xmax</span><span class="o">=</span><span class="mi">2500</span><span class="p">)</span>


    
    <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="n">title</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="n">x_label</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="n">y_label</span><span class="p">)</span>

    <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">gcf</span><span class="p">()</span>
    

    <span class="n">folder_path</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">parents</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">fig_id</span><span class="o">&lt;</span><span class="mi">10</span><span class="p">:</span>
        <span class="n">filename</span> <span class="o">=</span> <span class="s2">&quot;0&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">fig_id</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;_&quot;</span> <span class="o">+</span> <span class="n">file_prefix</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">filename</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">fig_id</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;_&quot;</span> <span class="o">+</span> <span class="n">file_prefix</span>

    <span class="n">fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">folder_path</span> <span class="o">/</span> <span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;.svg&#39;</span><span class="p">),</span> <span class="n">facecolor</span><span class="o">=</span><span class="s1">&#39;white&#39;</span><span class="p">)</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">folder_path</span> <span class="o">/</span> <span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;.png&#39;</span><span class="p">),</span> <span class="n">facecolor</span><span class="o">=</span><span class="s1">&#39;white&#39;</span><span class="p">)</span>
    <span class="n">fig_id</span> <span class="o">=</span> <span class="n">fig_id</span> <span class="o">+</span> <span class="mi">1</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">fig_id</span>

<span class="c1">## Load database</span>

<span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_pickle</span><span class="p">(</span><span class="n">database_path</span><span class="p">)</span>

<span class="c1">## Initialize array</span>

<span class="n">dataset_estimate</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([])</span>
<span class="n">dataset_std</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([])</span>

<span class="n">index</span> <span class="o">=</span> <span class="mf">6.001</span>

<span class="n">serial_number</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">index</span><span class="p">][</span><span class="s1">&#39;phantom serial number&#39;</span><span class="p">]</span>


<span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">get_NIST_ids</span><span class="p">():</span>
    <span class="k">if</span> <span class="n">estimate_type</span> <span class="o">==</span> <span class="s1">&#39;mean&#39;</span><span class="p">:</span>
        <span class="n">dataset_estimate</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">dataset_estimate</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">index</span><span class="p">][</span><span class="n">key</span><span class="p">]))</span>
    <span class="k">elif</span> <span class="n">estimate_type</span> <span class="o">==</span> <span class="s1">&#39;median&#39;</span><span class="p">:</span>
        <span class="n">dataset_estimate</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">dataset_estimate</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">median</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">index</span><span class="p">][</span><span class="n">key</span><span class="p">]))</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;Unsupported dataset estimate type.&#39;</span><span class="p">)</span>

    <span class="n">dataset_std</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">dataset_std</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">index</span><span class="p">][</span><span class="n">key</span><span class="p">]))</span>

<span class="n">ref_values</span> <span class="o">=</span> <span class="n">get_reference_NIST_values</span><span class="p">(</span><span class="n">serial_number</span><span class="p">)</span>

<span class="n">temperature</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">index</span><span class="p">][</span><span class="s1">&#39;phantom temperature&#39;</span><span class="p">]</span>
<span class="n">temp_corrected_ref_values</span> <span class="o">=</span> <span class="n">temperature_correction</span><span class="p">(</span><span class="n">temperature</span><span class="p">,</span> <span class="n">serial_number</span><span class="p">)</span>


<span class="c1"># PYTHON CODE</span>
<span class="c1"># Module imports</span>

<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">from</span> <span class="nn">PIL</span> <span class="kn">import</span> <span class="n">Image</span>
<span class="kn">from</span> <span class="nn">matplotlib.image</span> <span class="kn">import</span> <span class="n">imread</span>
<span class="kn">import</span> <span class="nn">scipy.io</span>
<span class="kn">import</span> <span class="nn">plotly.graph_objs</span> <span class="k">as</span> <span class="nn">go</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">plotly</span> <span class="kn">import</span> <span class="n">__version__</span>
<span class="kn">from</span> <span class="nn">plotly.offline</span> <span class="kn">import</span> <span class="n">init_notebook_mode</span><span class="p">,</span> <span class="n">iplot</span><span class="p">,</span> <span class="n">plot</span>
<span class="n">config</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;showLink&#39;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span> <span class="s1">&#39;displayModeBar&#39;</span><span class="p">:</span> <span class="kc">False</span><span class="p">}</span>

<span class="n">init_notebook_mode</span><span class="p">(</span><span class="n">connected</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="kn">from</span> <span class="nn">IPython.display</span> <span class="kn">import</span> <span class="n">display</span><span class="p">,</span> <span class="n">HTML</span>

<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">markdown</span>
<span class="kn">import</span> <span class="nn">random</span>
<span class="kn">from</span> <span class="nn">scipy.integrate</span> <span class="kn">import</span> <span class="n">quad</span>

<span class="kn">import</span> <span class="nn">warnings</span>
<span class="n">warnings</span><span class="o">.</span><span class="n">filterwarnings</span><span class="p">(</span><span class="s1">&#39;ignore&#39;</span><span class="p">)</span>
<span class="n">config</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;showLink&#39;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span> <span class="s1">&#39;displayModeBar&#39;</span><span class="p">:</span> <span class="kc">False</span><span class="p">}</span>

<span class="n">lin_line</span> <span class="o">=</span> <span class="n">go</span><span class="o">.</span><span class="n">Scatter</span><span class="p">(</span>
    <span class="n">x</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">2500</span><span class="p">),</span>
    <span class="n">y</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">2500</span><span class="p">),</span>
    <span class="n">name</span><span class="o">=</span><span class="s2">&quot;slope&quot;</span><span class="p">,</span>
    <span class="n">line_shape</span><span class="o">=</span><span class="s1">&#39;linear&#39;</span><span class="p">,</span>
    <span class="n">line</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;dash&#39;</span><span class="p">:</span> <span class="s1">&#39;dash&#39;</span><span class="p">,</span><span class="s1">&#39;color&#39;</span><span class="p">:</span> <span class="s1">&#39;black&#39;</span><span class="p">},</span>
    <span class="n">visible</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
    <span class="n">showlegend</span> <span class="o">=</span> <span class="kc">False</span>
<span class="p">)</span>

<span class="n">data_lin</span><span class="o">=</span><span class="n">go</span><span class="o">.</span><span class="n">Scatter</span><span class="p">(</span>
    <span class="n">x</span><span class="o">=</span><span class="n">temp_corrected_ref_values</span><span class="p">,</span>
    <span class="n">y</span><span class="o">=</span><span class="n">dataset_estimate</span><span class="p">,</span>
    <span class="n">error_y</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span>
        <span class="nb">type</span><span class="o">=</span><span class="s1">&#39;data&#39;</span><span class="p">,</span> <span class="c1"># value of error bar given in data coordinates</span>
        <span class="n">array</span><span class="o">=</span><span class="n">dataset_std</span><span class="p">,</span>
        <span class="n">visible</span><span class="o">=</span><span class="kc">True</span><span class="p">),</span>
    <span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;id: &#39;</span><span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">index</span><span class="p">),</span>
    <span class="n">mode</span> <span class="o">=</span> <span class="s1">&#39;markers&#39;</span><span class="p">,</span>
    <span class="n">marker</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;#007ea7&#39;</span><span class="p">),</span>
    <span class="n">visible</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
    <span class="n">showlegend</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="p">)</span>

<span class="n">data_log</span><span class="o">=</span><span class="n">go</span><span class="o">.</span><span class="n">Scatter</span><span class="p">(</span>
    <span class="n">x</span><span class="o">=</span><span class="n">temp_corrected_ref_values</span><span class="p">,</span>
    <span class="n">y</span><span class="o">=</span><span class="n">dataset_estimate</span><span class="p">,</span>
    <span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;id: &#39;</span><span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">index</span><span class="p">),</span>
    <span class="n">mode</span> <span class="o">=</span> <span class="s1">&#39;markers&#39;</span><span class="p">,</span>
    <span class="n">marker</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;#007ea7&#39;</span><span class="p">),</span>
    <span class="n">visible</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
    <span class="n">showlegend</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="p">)</span>
<span class="n">data_error</span><span class="o">=</span><span class="n">go</span><span class="o">.</span><span class="n">Scatter</span><span class="p">(</span>
    <span class="n">x</span><span class="o">=</span><span class="n">temp_corrected_ref_values</span><span class="p">,</span>
    <span class="n">y</span><span class="o">=</span> <span class="n">calc_error</span><span class="p">(</span><span class="n">temp_corrected_ref_values</span><span class="p">,</span><span class="n">dataset_estimate</span><span class="p">),</span>
    <span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;id: &#39;</span><span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">index</span><span class="p">),</span>
    <span class="n">mode</span> <span class="o">=</span> <span class="s1">&#39;markers&#39;</span><span class="p">,</span>
    <span class="n">marker</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;#007ea7&#39;</span><span class="p">),</span>
    <span class="n">visible</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
    <span class="n">showlegend</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="p">)</span>
<span class="n">err_solid_line</span> <span class="o">=</span> <span class="n">go</span><span class="o">.</span><span class="n">Scatter</span><span class="p">(</span>
    <span class="n">x</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">2500</span><span class="p">),</span>
    <span class="n">y</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">2500</span><span class="p">)</span><span class="o">*</span><span class="mi">0</span><span class="p">,</span>
    <span class="n">name</span><span class="o">=</span><span class="s2">&quot;0 </span><span class="si">% e</span><span class="s2">rror line&quot;</span><span class="p">,</span>
    <span class="n">line_shape</span><span class="o">=</span><span class="s1">&#39;linear&#39;</span><span class="p">,</span>
    <span class="n">line</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;dash&#39;</span><span class="p">:</span> <span class="s1">&#39;solid&#39;</span><span class="p">,</span><span class="s1">&#39;color&#39;</span><span class="p">:</span> <span class="s1">&#39;black&#39;</span><span class="p">},</span>
    <span class="n">visible</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
    <span class="n">showlegend</span> <span class="o">=</span> <span class="kc">False</span>
<span class="p">)</span>
<span class="n">err_p10_line</span> <span class="o">=</span> <span class="n">go</span><span class="o">.</span><span class="n">Scatter</span><span class="p">(</span>
    <span class="n">x</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">2500</span><span class="p">),</span>
    <span class="n">y</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">2500</span><span class="p">)</span><span class="o">*</span><span class="mi">0</span><span class="o">+</span><span class="mi">10</span><span class="p">,</span>
    <span class="n">name</span><span class="o">=</span><span class="s2">&quot;+10</span><span class="si">% e</span><span class="s2">rror&quot;</span><span class="p">,</span>
    <span class="n">line_shape</span><span class="o">=</span><span class="s1">&#39;linear&#39;</span><span class="p">,</span>
    <span class="n">line</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;dash&#39;</span><span class="p">:</span> <span class="s1">&#39;dash&#39;</span><span class="p">,</span><span class="s1">&#39;color&#39;</span><span class="p">:</span> <span class="s1">&#39;black&#39;</span><span class="p">},</span>
    <span class="n">visible</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
    <span class="n">showlegend</span> <span class="o">=</span> <span class="kc">False</span>
<span class="p">)</span>
<span class="n">err_m10_line</span> <span class="o">=</span> <span class="n">go</span><span class="o">.</span><span class="n">Scatter</span><span class="p">(</span>
    <span class="n">x</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">2500</span><span class="p">),</span>
    <span class="n">y</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">2500</span><span class="p">)</span><span class="o">*</span><span class="mi">0</span><span class="o">-</span><span class="mi">10</span><span class="p">,</span>
    <span class="n">name</span><span class="o">=</span><span class="s2">&quot;-10</span><span class="si">% e</span><span class="s2">rror&quot;</span><span class="p">,</span>
    <span class="n">line_shape</span><span class="o">=</span><span class="s1">&#39;linear&#39;</span><span class="p">,</span>
    <span class="n">line</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;dash&#39;</span><span class="p">:</span> <span class="s1">&#39;dash&#39;</span><span class="p">,</span><span class="s1">&#39;color&#39;</span><span class="p">:</span> <span class="s1">&#39;black&#39;</span><span class="p">},</span>
    <span class="n">visible</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
    <span class="n">showlegend</span> <span class="o">=</span> <span class="kc">False</span>
<span class="p">)</span>

<span class="n">data</span> <span class="o">=</span> <span class="p">[</span><span class="n">lin_line</span><span class="p">,</span> <span class="n">data_lin</span><span class="p">,</span> <span class="n">data_log</span><span class="p">,</span> <span class="n">data_error</span><span class="p">,</span> <span class="n">err_solid_line</span><span class="p">,</span> <span class="n">err_p10_line</span><span class="p">,</span> <span class="n">err_m10_line</span><span class="p">]</span>

<span class="kn">from</span> <span class="nn">plotly.subplots</span> <span class="kn">import</span> <span class="n">make_subplots</span>
<span class="kn">import</span> <span class="nn">plotly.graph_objects</span> <span class="k">as</span> <span class="nn">go</span>

<span class="n">fig</span> <span class="o">=</span> <span class="n">make_subplots</span><span class="p">(</span><span class="n">rows</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">cols</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">horizontal_spacing</span> <span class="o">=</span> <span class="mf">0.08</span><span class="p">)</span>

<span class="n">fig</span><span class="o">.</span><span class="n">add_trace</span><span class="p">(</span>
    <span class="n">lin_line</span><span class="p">,</span>
    <span class="n">row</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">col</span><span class="o">=</span><span class="mi">1</span>
<span class="p">)</span>

<span class="n">fig</span><span class="o">.</span><span class="n">add_trace</span><span class="p">(</span>
    <span class="n">data_lin</span><span class="p">,</span>
    <span class="n">row</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">col</span><span class="o">=</span><span class="mi">1</span>
<span class="p">)</span>

<span class="n">fig</span><span class="o">.</span><span class="n">add_trace</span><span class="p">(</span>
    <span class="n">data_log</span><span class="p">,</span>
    <span class="n">row</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">col</span><span class="o">=</span><span class="mi">2</span>
<span class="p">)</span>

<span class="n">fig</span><span class="o">.</span><span class="n">add_trace</span><span class="p">(</span>
    <span class="n">data_error</span><span class="p">,</span>
    <span class="n">row</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">col</span><span class="o">=</span><span class="mi">3</span>
<span class="p">)</span>

<span class="n">fig</span><span class="o">.</span><span class="n">add_trace</span><span class="p">(</span>
    <span class="n">err_solid_line</span><span class="p">,</span>
    <span class="n">row</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">col</span><span class="o">=</span><span class="mi">3</span>
<span class="p">)</span>

<span class="n">fig</span><span class="o">.</span><span class="n">add_trace</span><span class="p">(</span>
    <span class="n">err_p10_line</span><span class="p">,</span>
    <span class="n">row</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">col</span><span class="o">=</span><span class="mi">3</span>
<span class="p">)</span>

<span class="n">fig</span><span class="o">.</span><span class="n">add_trace</span><span class="p">(</span>
    <span class="n">err_m10_line</span><span class="p">,</span>
    <span class="n">row</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">col</span><span class="o">=</span><span class="mi">3</span>
<span class="p">)</span>

<span class="n">output_folder</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="s2">&quot;analysis/plots/04_alldatasets_scatter_NIST-temperature-corrected/&quot;</span><span class="p">)</span>

<span class="c1">## Initialize array</span>

<span class="n">dataset_mean</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">1</span><span class="p">,</span><span class="mi">14</span><span class="p">))</span>
<span class="n">dataset_std</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">1</span><span class="p">,</span><span class="mi">14</span><span class="p">))</span>
<span class="n">version</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([])</span>
<span class="n">temperature</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([])</span>
<span class="n">ref_values</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">1</span><span class="p">,</span><span class="mi">14</span><span class="p">))</span>


<span class="n">ii</span><span class="o">=</span><span class="mi">0</span>
<span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">df</span><span class="o">.</span><span class="n">iterrows</span><span class="p">():</span>
    <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">index</span><span class="p">][</span><span class="s1">&#39;T1 - NIST sphere 1&#39;</span><span class="p">])</span> <span class="ow">is</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>

        <span class="n">version</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">version</span><span class="p">,</span><span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">index</span><span class="p">][</span><span class="s1">&#39;phantom serial number&#39;</span><span class="p">])</span>
        <span class="n">temperature</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">temperature</span><span class="p">,</span> <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">index</span><span class="p">][</span><span class="s1">&#39;phantom temperature&#39;</span><span class="p">])</span>


        <span class="k">if</span> <span class="n">version</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">version</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span> <span class="o">=</span> <span class="mi">999</span> <span class="c1"># Missing version, only known case is one where we have version &gt; 42 right now.</span>
        
        <span class="k">if</span> <span class="n">temperature</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">temperature</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span> <span class="o">=</span> <span class="mi">20</span> <span class="c1"># Missing temperature, assume it to be 20C (reference temperature).</span>
            
            
        <span class="k">if</span> <span class="n">ii</span><span class="o">==</span><span class="mi">0</span><span class="p">:</span>
            <span class="n">ref_values</span> <span class="o">=</span> <span class="n">get_reference_NIST_values</span><span class="p">(</span><span class="n">version</span><span class="p">[</span><span class="n">ii</span><span class="p">])</span>
            <span class="n">temp_corrected_ref_values</span> <span class="o">=</span> <span class="n">temperature_correction</span><span class="p">(</span><span class="n">temperature</span><span class="p">[</span><span class="n">ii</span><span class="p">],</span> <span class="n">version</span><span class="p">[</span><span class="n">ii</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">ref_values</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">((</span><span class="n">ref_values</span><span class="p">,</span> <span class="n">get_reference_NIST_values</span><span class="p">(</span><span class="n">version</span><span class="p">[</span><span class="n">ii</span><span class="p">])))</span>
            <span class="n">temp_corrected_ref_values</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">((</span><span class="n">temp_corrected_ref_values</span><span class="p">,</span> <span class="n">temperature_correction</span><span class="p">(</span><span class="n">temperature</span><span class="p">[</span><span class="n">ii</span><span class="p">],</span> <span class="n">version</span><span class="p">[</span><span class="n">ii</span><span class="p">])))</span>
        
        <span class="n">tmp_dataset_estimate</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([])</span>
        <span class="n">tmp_dataset_std</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([])</span>

        <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">get_NIST_ids</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">estimate_type</span> <span class="ow">is</span> <span class="s1">&#39;mean&#39;</span><span class="p">:</span>
                <span class="n">tmp_dataset_estimate</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">tmp_dataset_estimate</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">index</span><span class="p">][</span><span class="n">key</span><span class="p">]))</span>
            <span class="k">elif</span> <span class="n">estimate_type</span> <span class="ow">is</span> <span class="s1">&#39;median&#39;</span><span class="p">:</span>
                <span class="n">tmp_dataset_estimate</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">tmp_dataset_estimate</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">median</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">index</span><span class="p">][</span><span class="n">key</span><span class="p">]))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;Unsupported dataset estimate type.&#39;</span><span class="p">)</span>

            <span class="n">tmp_dataset_std</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">tmp_dataset_std</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">index</span><span class="p">][</span><span class="n">key</span><span class="p">]))</span>

        <span class="k">if</span> <span class="n">ii</span><span class="o">==</span><span class="mi">0</span><span class="p">:</span>
            <span class="n">dataset_estimate</span> <span class="o">=</span> <span class="n">tmp_dataset_estimate</span>  
            <span class="n">dataset_std</span> <span class="o">=</span> <span class="n">tmp_dataset_std</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">dataset_estimate</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">((</span><span class="n">dataset_estimate</span><span class="p">,</span> <span class="n">tmp_dataset_estimate</span><span class="p">))</span>
            <span class="n">dataset_std</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">((</span><span class="n">dataset_std</span><span class="p">,</span> <span class="n">tmp_dataset_std</span><span class="p">))</span>

        <span class="n">ii</span><span class="o">=</span><span class="n">ii</span><span class="o">+</span><span class="mi">1</span>

<span class="c1">## Setup for plots</span>
<span class="n">fig_id</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">dims</span><span class="o">=</span><span class="n">ref_values</span><span class="o">.</span><span class="n">shape</span>
<span class="n">file_prefix</span> <span class="o">=</span> <span class="s1">&#39;alldatasets&#39;</span>

<span class="n">fig</span><span class="o">.</span><span class="n">add_trace</span><span class="p">(</span>
    <span class="n">lin_line</span><span class="p">,</span>
    <span class="n">row</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">col</span><span class="o">=</span><span class="mi">1</span>
<span class="p">)</span>

<span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">dims</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
    <span class="n">data_lin</span><span class="o">=</span><span class="n">go</span><span class="o">.</span><span class="n">Scatter</span><span class="p">(</span>
        <span class="n">x</span><span class="o">=</span><span class="n">temp_corrected_ref_values</span><span class="p">[</span><span class="n">ii</span><span class="p">,:],</span>
        <span class="n">y</span><span class="o">=</span><span class="n">dataset_estimate</span><span class="p">[</span><span class="n">ii</span><span class="p">,:],</span>
        <span class="n">error_y</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span>
            <span class="nb">type</span><span class="o">=</span><span class="s1">&#39;data&#39;</span><span class="p">,</span> <span class="c1"># value of error bar given in data coordinates</span>
            <span class="n">array</span><span class="o">=</span><span class="n">dataset_std</span><span class="p">[</span><span class="n">ii</span><span class="p">,:],</span>
            <span class="n">visible</span><span class="o">=</span><span class="kc">True</span><span class="p">),</span>
        <span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;id: &#39;</span><span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="n">ii</span><span class="p">]),</span>
        <span class="n">mode</span> <span class="o">=</span> <span class="s1">&#39;markers&#39;</span><span class="p">,</span>
        <span class="n">visible</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
        <span class="n">showlegend</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="n">fig</span><span class="o">.</span><span class="n">add_trace</span><span class="p">(</span>
        <span class="n">data_lin</span><span class="p">,</span>
        <span class="n">row</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">col</span><span class="o">=</span><span class="mi">1</span>
    <span class="p">)</span>


<span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">dims</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
    <span class="n">data_log</span><span class="o">=</span><span class="n">go</span><span class="o">.</span><span class="n">Scatter</span><span class="p">(</span>
        <span class="n">x</span><span class="o">=</span><span class="n">temp_corrected_ref_values</span><span class="p">[</span><span class="n">ii</span><span class="p">,:],</span>
        <span class="n">y</span><span class="o">=</span><span class="n">dataset_estimate</span><span class="p">[</span><span class="n">ii</span><span class="p">,:],</span>
        <span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;id: &#39;</span><span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="n">ii</span><span class="p">]),</span>
        <span class="n">mode</span> <span class="o">=</span> <span class="s1">&#39;markers&#39;</span><span class="p">,</span>
        <span class="n">visible</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
        <span class="n">showlegend</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="p">)</span>

    <span class="n">fig</span><span class="o">.</span><span class="n">add_trace</span><span class="p">(</span>
        <span class="n">data_log</span><span class="p">,</span>
        <span class="n">row</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">col</span><span class="o">=</span><span class="mi">2</span>
    <span class="p">)</span>

<span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">dims</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
    <span class="n">data_error</span><span class="o">=</span><span class="n">go</span><span class="o">.</span><span class="n">Scatter</span><span class="p">(</span>
        <span class="n">x</span><span class="o">=</span><span class="n">temp_corrected_ref_values</span><span class="p">[</span><span class="n">ii</span><span class="p">,:],</span>
        <span class="n">y</span><span class="o">=</span> <span class="n">calc_error</span><span class="p">(</span><span class="n">temp_corrected_ref_values</span><span class="p">[</span><span class="n">ii</span><span class="p">,:],</span><span class="n">dataset_estimate</span><span class="p">[</span><span class="n">ii</span><span class="p">,:]),</span>
        <span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;id: &#39;</span><span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="n">ii</span><span class="p">]),</span>
        <span class="n">mode</span> <span class="o">=</span> <span class="s1">&#39;markers&#39;</span><span class="p">,</span>
        <span class="n">visible</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
        <span class="n">showlegend</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="p">)</span>

    <span class="n">fig</span><span class="o">.</span><span class="n">add_trace</span><span class="p">(</span>
        <span class="n">data_error</span><span class="p">,</span>
        <span class="n">row</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">col</span><span class="o">=</span><span class="mi">3</span>
    <span class="p">)</span>

<span class="n">fig</span><span class="o">.</span><span class="n">add_trace</span><span class="p">(</span>
    <span class="n">err_solid_line</span><span class="p">,</span>
    <span class="n">row</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">col</span><span class="o">=</span><span class="mi">3</span>
<span class="p">)</span>

<span class="n">fig</span><span class="o">.</span><span class="n">add_trace</span><span class="p">(</span>
    <span class="n">err_p10_line</span><span class="p">,</span>
    <span class="n">row</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">col</span><span class="o">=</span><span class="mi">3</span>
<span class="p">)</span>

<span class="n">fig</span><span class="o">.</span><span class="n">add_trace</span><span class="p">(</span>
    <span class="n">err_m10_line</span><span class="p">,</span>
    <span class="n">row</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">col</span><span class="o">=</span><span class="mi">3</span>
<span class="p">)</span>

<span class="n">fig</span><span class="o">.</span><span class="n">update_xaxes</span><span class="p">(</span>
    <span class="nb">type</span><span class="o">=</span><span class="s2">&quot;linear&quot;</span><span class="p">,</span>
    <span class="nb">range</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">2500</span><span class="p">],</span>
    <span class="n">title</span><span class="o">=</span><span class="s1">&#39;Reference T&lt;sub&gt;1&lt;/sub&gt; (ms)&#39;</span><span class="p">,</span>
    <span class="n">showgrid</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">gridcolor</span><span class="o">=</span><span class="s1">&#39;rgb(169,169,169)&#39;</span><span class="p">,</span>
    <span class="n">tick0</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
    <span class="n">dtick</span> <span class="o">=</span> <span class="mi">500</span><span class="p">,</span>
    <span class="n">linecolor</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">,</span>
    <span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
    <span class="n">row</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">col</span><span class="o">=</span><span class="mi">1</span>
    <span class="p">)</span>
<span class="n">fig</span><span class="o">.</span><span class="n">update_yaxes</span><span class="p">(</span>
    <span class="nb">type</span><span class="o">=</span><span class="s2">&quot;linear&quot;</span><span class="p">,</span>
    <span class="nb">range</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">2500</span><span class="p">],</span>
    <span class="n">title</span><span class="o">=</span><span class="p">{</span>
        <span class="s1">&#39;text&#39;</span><span class="p">:</span><span class="s1">&#39;T&lt;sub&gt;1&lt;/sub&gt; estimate (ms)&#39;</span><span class="p">,</span>
        <span class="s1">&#39;standoff&#39;</span><span class="p">:</span><span class="mi">0</span>
        <span class="p">},</span>
    <span class="n">showgrid</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">tick0</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
    <span class="n">dtick</span> <span class="o">=</span> <span class="mi">500</span><span class="p">,</span>
    <span class="n">gridcolor</span><span class="o">=</span><span class="s1">&#39;rgb(169,169,169)&#39;</span><span class="p">,</span>
    <span class="n">linecolor</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">,</span>
    <span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
    <span class="n">row</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">col</span><span class="o">=</span><span class="mi">1</span>
    <span class="p">)</span>

<span class="n">fig</span><span class="o">.</span><span class="n">update_xaxes</span><span class="p">(</span>
    <span class="nb">type</span><span class="o">=</span><span class="s2">&quot;log&quot;</span><span class="p">,</span>
    <span class="nb">range</span><span class="o">=</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="mi">20</span><span class="p">),</span><span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="mi">2500</span><span class="p">)],</span>
    <span class="n">title</span><span class="o">=</span><span class="s1">&#39;Reference T&lt;sub&gt;1&lt;/sub&gt; (ms)&#39;</span><span class="p">,</span>
    <span class="n">showgrid</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">gridcolor</span><span class="o">=</span><span class="s1">&#39;rgb(169,169,169)&#39;</span><span class="p">,</span>
    <span class="n">minor</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">ticks</span><span class="o">=</span><span class="s2">&quot;inside&quot;</span><span class="p">,</span> <span class="n">ticklen</span><span class="o">=</span><span class="mi">6</span><span class="p">,</span> <span class="n">showgrid</span><span class="o">=</span><span class="kc">True</span><span class="p">),</span>
    <span class="n">linecolor</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">,</span>
    <span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
    <span class="n">row</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">col</span><span class="o">=</span><span class="mi">2</span>
    <span class="p">)</span>
<span class="n">fig</span><span class="o">.</span><span class="n">update_yaxes</span><span class="p">(</span>
    <span class="nb">type</span><span class="o">=</span><span class="s2">&quot;log&quot;</span><span class="p">,</span>
    <span class="nb">range</span><span class="o">=</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="mi">20</span><span class="p">),</span><span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="mi">2500</span><span class="p">)],</span>
    <span class="n">title</span><span class="o">=</span><span class="p">{</span>
        <span class="s1">&#39;text&#39;</span><span class="p">:</span><span class="s1">&#39;T&lt;sub&gt;1&lt;/sub&gt; estimate (ms)&#39;</span><span class="p">,</span>
        <span class="s1">&#39;standoff&#39;</span><span class="p">:</span><span class="mi">0</span>
        <span class="p">},</span>
    <span class="n">showgrid</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">gridcolor</span><span class="o">=</span><span class="s1">&#39;rgb(169,169,169)&#39;</span><span class="p">,</span>
    <span class="n">minor</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">ticks</span><span class="o">=</span><span class="s2">&quot;inside&quot;</span><span class="p">,</span> <span class="n">ticklen</span><span class="o">=</span><span class="mi">6</span><span class="p">,</span> <span class="n">showgrid</span><span class="o">=</span><span class="kc">True</span><span class="p">),</span>
    <span class="n">linecolor</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">,</span>
    <span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
    <span class="n">row</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">col</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>

<span class="n">fig</span><span class="o">.</span><span class="n">update_xaxes</span><span class="p">(</span>
    <span class="nb">type</span><span class="o">=</span><span class="s2">&quot;linear&quot;</span><span class="p">,</span>
    <span class="nb">range</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">2500</span><span class="p">],</span>
    <span class="n">title</span><span class="o">=</span><span class="s1">&#39;Reference T&lt;sub&gt;1&lt;/sub&gt; (ms)&#39;</span><span class="p">,</span>
    <span class="n">showgrid</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">gridcolor</span><span class="o">=</span><span class="s1">&#39;rgb(169,169,169)&#39;</span><span class="p">,</span>
    <span class="n">tick0</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
    <span class="n">dtick</span> <span class="o">=</span> <span class="mi">500</span><span class="p">,</span>
    <span class="n">linecolor</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">,</span>
    <span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
    <span class="n">row</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">col</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>

<span class="n">fig</span><span class="o">.</span><span class="n">update_yaxes</span><span class="p">(</span>
    <span class="nb">type</span><span class="o">=</span><span class="s2">&quot;linear&quot;</span><span class="p">,</span>
    <span class="nb">range</span><span class="o">=</span><span class="p">[</span><span class="o">-</span><span class="mi">100</span><span class="p">,</span><span class="mi">100</span><span class="p">],</span>
    <span class="n">title</span><span class="o">=</span><span class="p">{</span>
        <span class="s1">&#39;text&#39;</span><span class="p">:</span><span class="s1">&#39;Error (%)&#39;</span><span class="p">,</span>
        <span class="s1">&#39;standoff&#39;</span><span class="p">:</span><span class="mi">0</span>
        <span class="p">},</span>
    <span class="n">showgrid</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">gridcolor</span><span class="o">=</span><span class="s1">&#39;rgb(169,169,169)&#39;</span><span class="p">,</span>
    <span class="n">tick0</span> <span class="o">=</span> <span class="o">-</span><span class="mi">100</span><span class="p">,</span>
    <span class="n">dtick</span> <span class="o">=</span> <span class="mi">25</span><span class="p">,</span>
    <span class="n">linecolor</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">,</span>
    <span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
    <span class="n">row</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">col</span><span class="o">=</span><span class="mi">3</span>
    <span class="p">)</span>


<span class="n">fig</span><span class="o">.</span><span class="n">update_xaxes</span><span class="p">(</span>
    <span class="nb">type</span><span class="o">=</span><span class="s2">&quot;linear&quot;</span><span class="p">,</span>
    <span class="nb">range</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">2500</span><span class="p">],</span>
    <span class="n">title</span><span class="o">=</span><span class="s1">&#39;Reference T&lt;sub&gt;1&lt;/sub&gt; (ms)&#39;</span><span class="p">,</span>
    <span class="n">showgrid</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">gridcolor</span><span class="o">=</span><span class="s1">&#39;rgb(169,169,169)&#39;</span><span class="p">,</span>
    <span class="n">tick0</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
    <span class="n">dtick</span> <span class="o">=</span> <span class="mi">500</span><span class="p">,</span>
    <span class="n">linecolor</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">,</span>
    <span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
    <span class="n">row</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">col</span><span class="o">=</span><span class="mi">1</span>
    <span class="p">)</span>
<span class="n">fig</span><span class="o">.</span><span class="n">update_yaxes</span><span class="p">(</span>
    <span class="nb">type</span><span class="o">=</span><span class="s2">&quot;linear&quot;</span><span class="p">,</span>
    <span class="nb">range</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">2500</span><span class="p">],</span>
    <span class="n">title</span><span class="o">=</span><span class="p">{</span>
        <span class="s1">&#39;text&#39;</span><span class="p">:</span><span class="s1">&#39;T&lt;sub&gt;1&lt;/sub&gt; estimate (ms)&#39;</span><span class="p">,</span>
        <span class="s1">&#39;standoff&#39;</span><span class="p">:</span><span class="mi">0</span>
        <span class="p">},</span>
    <span class="n">showgrid</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">gridcolor</span><span class="o">=</span><span class="s1">&#39;rgb(169,169,169)&#39;</span><span class="p">,</span>
    <span class="n">tick0</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
    <span class="n">dtick</span> <span class="o">=</span> <span class="mi">500</span><span class="p">,</span>
    <span class="n">linecolor</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">,</span>
    <span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
    <span class="n">row</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">col</span><span class="o">=</span><span class="mi">1</span>
    <span class="p">)</span>

<span class="n">fig</span><span class="o">.</span><span class="n">update_xaxes</span><span class="p">(</span>
    <span class="nb">type</span><span class="o">=</span><span class="s2">&quot;log&quot;</span><span class="p">,</span>
    <span class="nb">range</span><span class="o">=</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="mi">20</span><span class="p">),</span><span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="mi">2500</span><span class="p">)],</span>
    <span class="n">title</span><span class="o">=</span><span class="s1">&#39;Reference T&lt;sub&gt;1&lt;/sub&gt; (ms)&#39;</span><span class="p">,</span>
    <span class="n">showgrid</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">gridcolor</span><span class="o">=</span><span class="s1">&#39;rgb(169,169,169)&#39;</span><span class="p">,</span>
    <span class="n">minor</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">ticks</span><span class="o">=</span><span class="s2">&quot;inside&quot;</span><span class="p">,</span> <span class="n">ticklen</span><span class="o">=</span><span class="mi">6</span><span class="p">,</span> <span class="n">showgrid</span><span class="o">=</span><span class="kc">True</span><span class="p">),</span>
    <span class="n">linecolor</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">,</span>
    <span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
    <span class="n">row</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">col</span><span class="o">=</span><span class="mi">2</span>
    <span class="p">)</span>
<span class="n">fig</span><span class="o">.</span><span class="n">update_yaxes</span><span class="p">(</span>
    <span class="nb">type</span><span class="o">=</span><span class="s2">&quot;log&quot;</span><span class="p">,</span>
    <span class="nb">range</span><span class="o">=</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="mi">20</span><span class="p">),</span><span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="mi">2500</span><span class="p">)],</span>
    <span class="n">title</span><span class="o">=</span><span class="p">{</span>
        <span class="s1">&#39;text&#39;</span><span class="p">:</span><span class="s1">&#39;T&lt;sub&gt;1&lt;/sub&gt; estimate (ms)&#39;</span><span class="p">,</span>
        <span class="s1">&#39;standoff&#39;</span><span class="p">:</span><span class="mi">0</span>
        <span class="p">},</span>
    <span class="n">showgrid</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">gridcolor</span><span class="o">=</span><span class="s1">&#39;rgb(169,169,169)&#39;</span><span class="p">,</span>
    <span class="n">minor</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">ticks</span><span class="o">=</span><span class="s2">&quot;inside&quot;</span><span class="p">,</span> <span class="n">ticklen</span><span class="o">=</span><span class="mi">6</span><span class="p">,</span> <span class="n">showgrid</span><span class="o">=</span><span class="kc">True</span><span class="p">),</span>
    <span class="n">linecolor</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">,</span>
    <span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
    <span class="n">row</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">col</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>

<span class="n">fig</span><span class="o">.</span><span class="n">update_xaxes</span><span class="p">(</span>
    <span class="nb">type</span><span class="o">=</span><span class="s2">&quot;linear&quot;</span><span class="p">,</span>
    <span class="nb">range</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">2500</span><span class="p">],</span>
    <span class="n">title</span><span class="o">=</span><span class="s1">&#39;Reference T&lt;sub&gt;1&lt;/sub&gt; (ms)&#39;</span><span class="p">,</span>
    <span class="n">showgrid</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">gridcolor</span><span class="o">=</span><span class="s1">&#39;rgb(169,169,169)&#39;</span><span class="p">,</span>
    <span class="n">tick0</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
    <span class="n">dtick</span> <span class="o">=</span> <span class="mi">500</span><span class="p">,</span>
    <span class="n">linecolor</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">,</span>
    <span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
    <span class="n">row</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">col</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>

<span class="n">fig</span><span class="o">.</span><span class="n">update_yaxes</span><span class="p">(</span>
    <span class="nb">type</span><span class="o">=</span><span class="s2">&quot;linear&quot;</span><span class="p">,</span>
    <span class="nb">range</span><span class="o">=</span><span class="p">[</span><span class="o">-</span><span class="mi">100</span><span class="p">,</span><span class="mi">100</span><span class="p">],</span>
    <span class="n">title</span><span class="o">=</span><span class="p">{</span>
        <span class="s1">&#39;text&#39;</span><span class="p">:</span><span class="s1">&#39;Error (%)&#39;</span><span class="p">,</span>
        <span class="s1">&#39;standoff&#39;</span><span class="p">:</span><span class="mi">0</span>
        <span class="p">},</span>
    <span class="n">showgrid</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">gridcolor</span><span class="o">=</span><span class="s1">&#39;rgb(169,169,169)&#39;</span><span class="p">,</span>
    <span class="n">tick0</span> <span class="o">=</span> <span class="o">-</span><span class="mi">100</span><span class="p">,</span>
    <span class="n">dtick</span> <span class="o">=</span> <span class="mi">25</span><span class="p">,</span>
    <span class="n">linecolor</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">,</span>
    <span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
    <span class="n">row</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">col</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span>
    <span class="p">)</span>

<span class="n">fig</span><span class="o">.</span><span class="n">update_layout</span><span class="p">(</span>
    <span class="n">margin</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">l</span><span class="o">=</span><span class="mi">30</span><span class="p">,</span> <span class="n">r</span><span class="o">=</span><span class="mi">30</span><span class="p">,</span> <span class="n">t</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">b</span><span class="o">=</span><span class="mi">30</span><span class="p">),</span>
    <span class="n">paper_bgcolor</span><span class="o">=</span><span class="s1">&#39;rgb(255, 255, 255)&#39;</span><span class="p">,</span>
    <span class="n">plot_bgcolor</span><span class="o">=</span><span class="s1">&#39;rgb(255, 255, 255)&#39;</span><span class="p">,</span>
    <span class="n">legend_title</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span>
    <span class="n">annotations</span><span class="o">=</span><span class="p">[</span>
        <span class="nb">dict</span><span class="p">(</span>
            <span class="n">x</span><span class="o">=-</span><span class="mf">0.05</span><span class="p">,</span>
            <span class="n">y</span><span class="o">=</span><span class="mf">0.53</span><span class="p">,</span>
            <span class="n">showarrow</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
            <span class="n">text</span><span class="o">=</span><span class="s1">&#39;&lt;b&gt;a&lt;/b&gt;&#39;</span><span class="p">,</span>
            <span class="n">font</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span>
                <span class="n">family</span><span class="o">=</span><span class="s1">&#39;Times New Roman&#39;</span><span class="p">,</span>
                <span class="n">size</span><span class="o">=</span><span class="mi">48</span>
            <span class="p">),</span>
            <span class="n">xref</span><span class="o">=</span><span class="s1">&#39;paper&#39;</span><span class="p">,</span>
            <span class="n">yref</span><span class="o">=</span><span class="s1">&#39;paper&#39;</span>
        <span class="p">),</span>
        <span class="nb">dict</span><span class="p">(</span>
            <span class="n">x</span><span class="o">=</span><span class="mf">0.32</span><span class="p">,</span>
            <span class="n">y</span><span class="o">=</span><span class="mf">0.53</span><span class="p">,</span>
            <span class="n">showarrow</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
            <span class="n">text</span><span class="o">=</span><span class="s1">&#39;&lt;b&gt;b&lt;/b&gt;&#39;</span><span class="p">,</span>
            <span class="n">font</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span>
                <span class="n">family</span><span class="o">=</span><span class="s1">&#39;Times New Roman&#39;</span><span class="p">,</span>
                <span class="n">size</span><span class="o">=</span><span class="mi">48</span>
            <span class="p">),</span>
            <span class="n">xref</span><span class="o">=</span><span class="s1">&#39;paper&#39;</span><span class="p">,</span>
            <span class="n">yref</span><span class="o">=</span><span class="s1">&#39;paper&#39;</span>
        <span class="p">),</span>
        <span class="nb">dict</span><span class="p">(</span>
            <span class="n">x</span><span class="o">=</span><span class="mf">0.7</span><span class="p">,</span>
            <span class="n">y</span><span class="o">=</span><span class="mf">0.53</span><span class="p">,</span>
            <span class="n">showarrow</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
            <span class="n">text</span><span class="o">=</span><span class="s1">&#39;&lt;b&gt;c&lt;/b&gt;&#39;</span><span class="p">,</span>
            <span class="n">font</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span>
                <span class="n">family</span><span class="o">=</span><span class="s1">&#39;Times New Roman&#39;</span><span class="p">,</span>
                <span class="n">size</span><span class="o">=</span><span class="mi">48</span>
            <span class="p">),</span>
            <span class="n">xref</span><span class="o">=</span><span class="s1">&#39;paper&#39;</span><span class="p">,</span>
            <span class="n">yref</span><span class="o">=</span><span class="s1">&#39;paper&#39;</span>
        <span class="p">),</span>
        <span class="nb">dict</span><span class="p">(</span>
            <span class="n">x</span><span class="o">=-</span><span class="mf">0.05</span><span class="p">,</span>
            <span class="n">y</span><span class="o">=-</span><span class="mf">0.11</span><span class="p">,</span>
            <span class="n">showarrow</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
            <span class="n">text</span><span class="o">=</span><span class="s1">&#39;&lt;b&gt;d&lt;/b&gt;&#39;</span><span class="p">,</span>
            <span class="n">font</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span>
                <span class="n">family</span><span class="o">=</span><span class="s1">&#39;Times New Roman&#39;</span><span class="p">,</span>
                <span class="n">size</span><span class="o">=</span><span class="mi">48</span>
            <span class="p">),</span>
            <span class="n">xref</span><span class="o">=</span><span class="s1">&#39;paper&#39;</span><span class="p">,</span>
            <span class="n">yref</span><span class="o">=</span><span class="s1">&#39;paper&#39;</span>
        <span class="p">),</span>
        <span class="nb">dict</span><span class="p">(</span>
            <span class="n">x</span><span class="o">=</span><span class="mf">0.32</span><span class="p">,</span>
            <span class="n">y</span><span class="o">=-</span><span class="mf">0.11</span><span class="p">,</span>
            <span class="n">showarrow</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
            <span class="n">text</span><span class="o">=</span><span class="s1">&#39;&lt;b&gt;e&lt;/b&gt;&#39;</span><span class="p">,</span>
            <span class="n">font</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span>
                <span class="n">family</span><span class="o">=</span><span class="s1">&#39;Times New Roman&#39;</span><span class="p">,</span>
                <span class="n">size</span><span class="o">=</span><span class="mi">48</span>
            <span class="p">),</span>
            <span class="n">xref</span><span class="o">=</span><span class="s1">&#39;paper&#39;</span><span class="p">,</span>
            <span class="n">yref</span><span class="o">=</span><span class="s1">&#39;paper&#39;</span>
        <span class="p">),</span>
        <span class="nb">dict</span><span class="p">(</span>
            <span class="n">x</span><span class="o">=</span><span class="mf">0.7</span><span class="p">,</span>
            <span class="n">y</span><span class="o">=-</span><span class="mf">0.11</span><span class="p">,</span>
            <span class="n">showarrow</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
            <span class="n">text</span><span class="o">=</span><span class="s1">&#39;&lt;b&gt;f&lt;/b&gt;&#39;</span><span class="p">,</span>
            <span class="n">font</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span>
                <span class="n">family</span><span class="o">=</span><span class="s1">&#39;Times New Roman&#39;</span><span class="p">,</span>
                <span class="n">size</span><span class="o">=</span><span class="mi">48</span>
            <span class="p">),</span>
            <span class="n">xref</span><span class="o">=</span><span class="s1">&#39;paper&#39;</span><span class="p">,</span>
            <span class="n">yref</span><span class="o">=</span><span class="s1">&#39;paper&#39;</span>
        <span class="p">),</span>
        <span class="p">]</span>
    <span class="p">)</span>

<span class="n">fig</span><span class="o">.</span><span class="n">update_layout</span><span class="p">(</span><span class="n">height</span><span class="o">=</span><span class="mi">600</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mi">960</span><span class="p">)</span>

<span class="c1">#iplot(fig, filename = &#39;figure3&#39;, config = config)</span>
<span class="n">plot</span><span class="p">(</span><span class="n">fig</span><span class="p">,</span> <span class="n">filename</span> <span class="o">=</span> <span class="s1">&#39;figure3.html&#39;</span><span class="p">,</span> <span class="n">config</span> <span class="o">=</span> <span class="n">config</span><span class="p">)</span>
<span class="n">display</span><span class="p">(</span><span class="n">HTML</span><span class="p">(</span><span class="s1">&#39;figure3.html&#39;</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;&gt;:59: SyntaxWarning: &quot;is&quot; with a literal. Did you mean &quot;==&quot;?
&lt;&gt;:65: SyntaxWarning: &quot;is&quot; with a literal. Did you mean &quot;==&quot;?
&lt;&gt;:70: SyntaxWarning: &quot;is&quot; with a literal. Did you mean &quot;==&quot;?
&lt;&gt;:306: SyntaxWarning: &quot;is&quot; with a literal. Did you mean &quot;==&quot;?
&lt;&gt;:308: SyntaxWarning: &quot;is&quot; with a literal. Did you mean &quot;==&quot;?
&lt;&gt;:59: SyntaxWarning: &quot;is&quot; with a literal. Did you mean &quot;==&quot;?
&lt;&gt;:65: SyntaxWarning: &quot;is&quot; with a literal. Did you mean &quot;==&quot;?
&lt;&gt;:70: SyntaxWarning: &quot;is&quot; with a literal. Did you mean &quot;==&quot;?
&lt;&gt;:306: SyntaxWarning: &quot;is&quot; with a literal. Did you mean &quot;==&quot;?
&lt;&gt;:308: SyntaxWarning: &quot;is&quot; with a literal. Did you mean &quot;==&quot;?
</pre></div>
</div>
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">NameError</span><span class="g g-Whitespace">                                 </span>Traceback (most recent call last)
<span class="n">Cell</span> <span class="n">In</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">line</span> <span class="mi">16</span>
<span class="g g-Whitespace">     </span><span class="mi">14</span>                 <span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">dir_name</span><span class="p">,</span> <span class="n">item</span><span class="p">))</span>
<span class="g g-Whitespace">     </span><span class="mi">15</span> <span class="k">elif</span> <span class="n">build</span> <span class="o">==</span> <span class="s1">&#39;archive&#39;</span><span class="p">:</span>
<span class="ne">---&gt; </span><span class="mi">16</span>     <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="n">Path</span><span class="p">(</span><span class="s1">&#39;../../data&#39;</span><span class="p">)):</span>
<span class="g g-Whitespace">     </span><span class="mi">17</span>         <span class="n">data_path</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;../../data/rrsg-2020-neurolibre&#39;</span><span class="p">]</span>
<span class="g g-Whitespace">     </span><span class="mi">18</span>     <span class="k">else</span><span class="p">:</span>
<span class="g g-Whitespace">     </span><span class="mi">19</span>         <span class="c1"># define data requirement path</span>

<span class="ne">NameError</span>: name &#39;Path&#39; is not defined
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">os</span> <span class="kn">import</span> <span class="n">path</span>
<span class="kn">import</span> <span class="nn">os</span>

<span class="k">if</span> <span class="n">build</span> <span class="o">==</span> <span class="s1">&#39;latest&#39;</span><span class="p">:</span>
    <span class="k">if</span> <span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="s1">&#39;analysis&#39;</span><span class="p">)</span><span class="o">==</span> <span class="kc">False</span><span class="p">:</span>
        <span class="o">!</span>git<span class="w"> </span>clone<span class="w"> </span>https://github.com/rrsg2020/analysis.git
        <span class="n">dir_name</span> <span class="o">=</span> <span class="s1">&#39;analysis&#39;</span>
        <span class="n">analysis</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">dir_name</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">analysis</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">item</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s2">&quot;.ipynb&quot;</span><span class="p">):</span>
                <span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">dir_name</span><span class="p">,</span> <span class="n">item</span><span class="p">))</span>
            <span class="k">if</span> <span class="n">item</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s2">&quot;.md&quot;</span><span class="p">):</span>
                <span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">dir_name</span><span class="p">,</span> <span class="n">item</span><span class="p">))</span>
<span class="k">elif</span> <span class="n">build</span> <span class="o">==</span> <span class="s1">&#39;archive&#39;</span><span class="p">:</span>
    <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="n">Path</span><span class="p">(</span><span class="s1">&#39;../../data&#39;</span><span class="p">)):</span>
        <span class="n">data_path</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;../../data/rrsg-2020-neurolibre&#39;</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="c1"># define data requirement path</span>
        <span class="n">data_req_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s2">&quot;..&quot;</span><span class="p">,</span> <span class="s2">&quot;binder&quot;</span><span class="p">,</span> <span class="s2">&quot;data_requirement.json&quot;</span><span class="p">)</span>
        <span class="c1"># download data</span>
        <span class="n">repo2data</span> <span class="o">=</span> <span class="n">Repo2Data</span><span class="p">(</span><span class="n">data_req_path</span><span class="p">)</span>
        <span class="n">data_path</span> <span class="o">=</span> <span class="n">repo2data</span><span class="o">.</span><span class="n">install</span><span class="p">()</span>         

<span class="c1"># Imports</span>
<span class="kn">import</span> <span class="nn">warnings</span>
<span class="n">warnings</span><span class="o">.</span><span class="n">filterwarnings</span><span class="p">(</span><span class="s2">&quot;ignore&quot;</span><span class="p">)</span>

<span class="kn">from</span> <span class="nn">pathlib</span> <span class="kn">import</span> <span class="n">Path</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">nibabel</span> <span class="k">as</span> <span class="nn">nib</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>

<span class="kn">from</span> <span class="nn">analysis.src.database</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="n">plt</span><span class="o">.</span><span class="n">style</span><span class="o">.</span><span class="n">use</span><span class="p">(</span><span class="s1">&#39;analysis/custom_matplotlibrc&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s2">&quot;figure.figsize&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="mi">20</span><span class="p">,</span><span class="mi">5</span><span class="p">)</span>
<span class="n">fig_id</span> <span class="o">=</span> <span class="mi">0</span>

<span class="c1"># Configurations</span>
<span class="k">if</span> <span class="n">build</span> <span class="o">==</span> <span class="s1">&#39;latest&#39;</span><span class="p">:</span>
    <span class="n">database_path</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="s1">&#39;analysis/databases/3T_human_T1maps_database.pkl&#39;</span><span class="p">)</span>
    <span class="n">output_folder</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="s2">&quot;analysis/plots/08_wholedataset_scatter_Human/&quot;</span><span class="p">)</span>
<span class="k">elif</span> <span class="n">build</span><span class="o">==</span><span class="s1">&#39;archive&#39;</span><span class="p">:</span>
    <span class="n">database_path</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">data_path</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39;/analysis/databases/3T_human_T1maps_database.pkl&#39;</span><span class="p">)</span>
    <span class="n">output_folder</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">data_path</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39;/analysis/plots/08_wholedataset_scatter_Human/&#39;</span><span class="p">)</span>

<span class="n">estimate_type</span> <span class="o">=</span> <span class="s1">&#39;mean&#39;</span> <span class="c1"># median or mean</span>

<span class="c1"># Define functions</span>

<span class="k">def</span> <span class="nf">plot_both_scatter</span><span class="p">(</span><span class="n">x1</span><span class="p">,</span> <span class="n">x2</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">y_std</span><span class="p">,</span>
                      <span class="n">title</span><span class="p">,</span> <span class="n">x1_label</span><span class="p">,</span> <span class="n">x2_label</span><span class="p">,</span> <span class="n">y_label</span><span class="p">,</span>
                      <span class="n">file_prefix</span><span class="p">,</span> <span class="n">folder_path</span><span class="p">,</span> <span class="n">fig_id</span><span class="p">):</span>
    
    <span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s2">&quot;figure.figsize&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="mi">20</span><span class="p">,</span><span class="mi">10</span><span class="p">)</span>

    <span class="n">fig</span><span class="p">,</span> <span class="n">axs</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span><span class="n">title</span><span class="p">)</span>
    <span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">errorbar</span><span class="p">(</span><span class="n">x1</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">y_std</span><span class="p">,</span> <span class="n">fmt</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">,</span> <span class="n">solid_capstyle</span><span class="o">=</span><span class="s1">&#39;projecting&#39;</span><span class="p">)</span>
    <span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="n">x1_label</span><span class="p">)</span>
    <span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="n">y_label</span><span class="p">)</span>
    <span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_xticks</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">x1</span><span class="p">),</span> <span class="n">step</span><span class="o">=</span><span class="mi">1</span><span class="p">))</span>


    <span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">errorbar</span><span class="p">(</span><span class="n">x2</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">y_std</span><span class="p">,</span> <span class="n">fmt</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">,</span> <span class="n">solid_capstyle</span><span class="o">=</span><span class="s1">&#39;projecting&#39;</span><span class="p">)</span>
    <span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="n">x2_label</span><span class="p">)</span>
    <span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="n">y_label</span><span class="p">)</span>
    <span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_xticklabels</span><span class="p">(</span><span class="n">labels</span><span class="o">=</span><span class="n">x2</span><span class="p">,</span> <span class="n">rotation</span><span class="o">=</span><span class="mi">90</span><span class="p">)</span>


    <span class="k">if</span> <span class="n">fig_id</span><span class="o">&lt;</span><span class="mi">10</span><span class="p">:</span>
        <span class="n">filename</span> <span class="o">=</span> <span class="s2">&quot;0&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">fig_id</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;_&quot;</span> <span class="o">+</span> <span class="n">file_prefix</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">filename</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">fig_id</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;_&quot;</span> <span class="o">+</span> <span class="n">file_prefix</span>

    <span class="n">fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">folder_path</span> <span class="o">/</span> <span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;.svg&#39;</span><span class="p">),</span> <span class="n">facecolor</span><span class="o">=</span><span class="s1">&#39;white&#39;</span><span class="p">)</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">folder_path</span> <span class="o">/</span> <span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;.png&#39;</span><span class="p">),</span> <span class="n">facecolor</span><span class="o">=</span><span class="s1">&#39;white&#39;</span><span class="p">)</span>
    <span class="n">fig_id</span> <span class="o">=</span> <span class="n">fig_id</span> <span class="o">+</span> <span class="mi">1</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">fig_id</span>

<span class="c1"># Load database</span>

<span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_pickle</span><span class="p">(</span><span class="n">database_path</span><span class="p">)</span>

<span class="n">genu_estimate</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([])</span>
<span class="n">genu_std</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([])</span>
<span class="n">splenium_estimate</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([])</span>
<span class="n">splenium_std</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([])</span>
<span class="n">deepgm_estimate</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([])</span>
<span class="n">deepgm_std</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([])</span>
<span class="n">cgm_estimate</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([])</span>
<span class="n">cgm_std</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([])</span>

<span class="n">ii</span> <span class="o">=</span> <span class="mi">0</span>
<span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">df</span><span class="o">.</span><span class="n">iterrows</span><span class="p">():</span>
    
    <span class="k">if</span> <span class="n">estimate_type</span> <span class="ow">is</span> <span class="s1">&#39;mean&#39;</span><span class="p">:</span>
        <span class="n">genu_estimate</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">genu_estimate</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">index</span><span class="p">][</span><span class="s1">&#39;T1 - genu (WM)&#39;</span><span class="p">]))</span>
        <span class="n">genu_std</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">genu_std</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">index</span><span class="p">][</span><span class="s1">&#39;T1 - genu (WM)&#39;</span><span class="p">]))</span>
        <span class="n">splenium_estimate</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">splenium_estimate</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">index</span><span class="p">][</span><span class="s1">&#39;T1 - splenium (WM)&#39;</span><span class="p">]))</span>
        <span class="n">splenium_std</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">splenium_std</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">index</span><span class="p">][</span><span class="s1">&#39;T1 - splenium (WM)&#39;</span><span class="p">]))</span>
        <span class="n">deepgm_estimate</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">deepgm_estimate</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">index</span><span class="p">][</span><span class="s1">&#39;T1 - deep GM&#39;</span><span class="p">]))</span>
        <span class="n">deepgm_std</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">deepgm_std</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">index</span><span class="p">][</span><span class="s1">&#39;T1 - deep GM&#39;</span><span class="p">]))</span>
        <span class="n">cgm_estimate</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">cgm_estimate</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">index</span><span class="p">][</span><span class="s1">&#39;T1 - cortical GM&#39;</span><span class="p">]))</span>
        <span class="n">cgm_std</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">cgm_std</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">index</span><span class="p">][</span><span class="s1">&#39;T1 - cortical GM&#39;</span><span class="p">]))</span>
    <span class="k">elif</span> <span class="n">estimate_type</span> <span class="ow">is</span> <span class="s1">&#39;median&#39;</span><span class="p">:</span>
        <span class="n">genu_estimate</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">genu_estimate</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">median</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">index</span><span class="p">][</span><span class="s1">&#39;T1 - genu (WM)&#39;</span><span class="p">]))</span>
        <span class="n">genu_std</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">genu_std</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">index</span><span class="p">][</span><span class="s1">&#39;T1 - genu (WM)&#39;</span><span class="p">]))</span>
        <span class="n">splenium_estimate</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">splenium_estimate</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">median</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">index</span><span class="p">][</span><span class="s1">&#39;T1 - splenium (WM)&#39;</span><span class="p">]))</span>
        <span class="n">splenium_std</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">splenium_std</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">index</span><span class="p">][</span><span class="s1">&#39;T1 - splenium (WM)&#39;</span><span class="p">]))</span>
        <span class="n">deepgm_estimate</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">deepgm_estimate</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">median</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">index</span><span class="p">][</span><span class="s1">&#39;T1 - deep GM&#39;</span><span class="p">]))</span>
        <span class="n">deepgm_std</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">deepgm_std</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">index</span><span class="p">][</span><span class="s1">&#39;T1 - deep GM&#39;</span><span class="p">]))</span>
        <span class="n">cgm_estimate</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">cgm_estimate</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">median</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">index</span><span class="p">][</span><span class="s1">&#39;T1 - cortical GM&#39;</span><span class="p">]))</span>
        <span class="n">cgm_std</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">cgm_std</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">index</span><span class="p">][</span><span class="s1">&#39;T1 - cortical GM&#39;</span><span class="p">]))</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;Unsupported dataset estimate type.&#39;</span><span class="p">)</span>
    <span class="n">ii</span> <span class="o">=</span> <span class="n">ii</span> <span class="o">+</span><span class="mi">1</span>

<span class="c1"># Store the IDs</span>
<span class="n">indexes_numbers</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">index</span>
<span class="n">indexes_strings</span> <span class="o">=</span> <span class="n">indexes_numbers</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="nb">str</span><span class="p">)</span>

<span class="n">x1_label</span><span class="o">=</span><span class="s1">&#39;Site #&#39;</span>
<span class="n">x2_label</span><span class="o">=</span><span class="s1">&#39;Site #.Meas #&#39;</span>
<span class="n">y_label</span><span class="o">=</span><span class="s2">&quot;T$_1$ (ms)&quot;</span>
<span class="n">file_prefix</span> <span class="o">=</span> <span class="s1">&#39;WM_and_GM&#39;</span>
<span class="n">folder_path</span><span class="o">=</span><span class="n">output_folder</span>

<span class="n">x1</span><span class="o">=</span><span class="n">indexes_numbers</span>
<span class="n">x2</span><span class="o">=</span><span class="n">indexes_strings</span>
<span class="n">y</span><span class="o">=</span><span class="n">genu_estimate</span>
<span class="n">y_std</span><span class="o">=</span><span class="n">genu_std</span>

<span class="c1"># Paper formatting of x tick labels (remove leading zero, pad zero at the end for multiples of 10)</span>
<span class="n">x3</span><span class="o">=</span><span class="p">[]</span>
<span class="k">for</span> <span class="n">num</span> <span class="ow">in</span> <span class="n">x2</span><span class="p">:</span>
    <span class="n">x3</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">num</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;.0&#39;</span><span class="p">,</span> <span class="s1">&#39;.&#39;</span><span class="p">))</span>

<span class="n">index</span><span class="o">=</span><span class="mi">0</span>
<span class="k">for</span> <span class="n">num</span> <span class="ow">in</span> <span class="n">x3</span><span class="p">:</span>
    <span class="k">if</span> <span class="n">num</span><span class="p">[</span><span class="o">-</span><span class="mi">3</span><span class="p">]</span> <span class="o">!=</span> <span class="s1">&#39;.&#39;</span><span class="p">:</span>
        <span class="n">x3</span><span class="p">[</span><span class="n">index</span><span class="p">]</span><span class="o">=</span><span class="n">num</span><span class="o">+</span><span class="s1">&#39;0&#39;</span>
    <span class="n">index</span><span class="o">+=</span><span class="mi">1</span>
</pre></div>
</div>
</div>
</div>
<div class="cell tag_report_output tag_hide_input docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">os</span> <span class="kn">import</span> <span class="n">path</span>
<span class="kn">import</span> <span class="nn">os</span>

<span class="k">if</span> <span class="n">build</span> <span class="o">==</span> <span class="s1">&#39;latest&#39;</span><span class="p">:</span>
    <span class="k">if</span> <span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="s1">&#39;analysis&#39;</span><span class="p">)</span><span class="o">==</span> <span class="kc">False</span><span class="p">:</span>
        <span class="o">!</span>git<span class="w"> </span>clone<span class="w"> </span>https://github.com/rrsg2020/analysis.git
        <span class="n">dir_name</span> <span class="o">=</span> <span class="s1">&#39;analysis&#39;</span>
        <span class="n">analysis</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">dir_name</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">analysis</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">item</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s2">&quot;.ipynb&quot;</span><span class="p">):</span>
                <span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">dir_name</span><span class="p">,</span> <span class="n">item</span><span class="p">))</span>
            <span class="k">if</span> <span class="n">item</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s2">&quot;.md&quot;</span><span class="p">):</span>
                <span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">dir_name</span><span class="p">,</span> <span class="n">item</span><span class="p">))</span>
<span class="k">elif</span> <span class="n">build</span> <span class="o">==</span> <span class="s1">&#39;archive&#39;</span><span class="p">:</span>
    <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="n">Path</span><span class="p">(</span><span class="s1">&#39;../../data&#39;</span><span class="p">)):</span>
        <span class="n">data_path</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;../../data/rrsg-2020-neurolibre&#39;</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="c1"># define data requirement path</span>
        <span class="n">data_req_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s2">&quot;..&quot;</span><span class="p">,</span> <span class="s2">&quot;binder&quot;</span><span class="p">,</span> <span class="s2">&quot;data_requirement.json&quot;</span><span class="p">)</span>
        <span class="c1"># download data</span>
        <span class="n">repo2data</span> <span class="o">=</span> <span class="n">Repo2Data</span><span class="p">(</span><span class="n">data_req_path</span><span class="p">)</span>
        <span class="n">data_path</span> <span class="o">=</span> <span class="n">repo2data</span><span class="o">.</span><span class="n">install</span><span class="p">()</span>

<span class="c1"># Imports</span>
<span class="kn">import</span> <span class="nn">warnings</span>
<span class="n">warnings</span><span class="o">.</span><span class="n">filterwarnings</span><span class="p">(</span><span class="s2">&quot;ignore&quot;</span><span class="p">)</span>

<span class="kn">from</span> <span class="nn">pathlib</span> <span class="kn">import</span> <span class="n">Path</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">json</span>
<span class="kn">import</span> <span class="nn">nibabel</span> <span class="k">as</span> <span class="nn">nib</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>

<span class="kn">from</span> <span class="nn">analysis.src.database</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">analysis.src.nist</span> <span class="kn">import</span> <span class="n">get_reference_NIST_values</span><span class="p">,</span> <span class="n">get_NIST_ids</span>
<span class="kn">from</span> <span class="nn">analysis.src.tools</span> <span class="kn">import</span> <span class="n">calc_error</span>
<span class="kn">from</span> <span class="nn">analysis.src.nist</span> <span class="kn">import</span> <span class="n">temperature_correction</span>

<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="n">plt</span><span class="o">.</span><span class="n">style</span><span class="o">.</span><span class="n">use</span><span class="p">(</span><span class="s1">&#39;analysis/custom_matplotlibrc&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s2">&quot;figure.figsize&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">10</span><span class="p">)</span>
<span class="n">fig_id</span> <span class="o">=</span> <span class="mi">0</span>

<span class="k">if</span> <span class="n">build</span> <span class="o">==</span> <span class="s1">&#39;latest&#39;</span><span class="p">:</span>
    <span class="n">database_path</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="s1">&#39;analysis/databases/3T_NIST_T1maps_database.pkl&#39;</span><span class="p">)</span>
    <span class="n">output_folder</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="s2">&quot;analysis/plots/03_singledataset_scatter_NIST-temperature-corrected/&quot;</span><span class="p">)</span>
<span class="k">elif</span> <span class="n">build</span><span class="o">==</span><span class="s1">&#39;archive&#39;</span><span class="p">:</span>
    <span class="n">database_path</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">data_path</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39;/analysis/databases/3T_NIST_T1maps_database.pkl&#39;</span><span class="p">)</span>
    <span class="n">output_folder</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">data_path</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39;/analysis/plots/03_singledataset_scatter_NIST-temperature-corrected/&#39;</span><span class="p">)</span>

<span class="n">estimate_type</span> <span class="o">=</span> <span class="s1">&#39;mean&#39;</span> <span class="c1"># median or mean</span>

<span class="c1">## Define Functions</span>
<span class="k">def</span> <span class="nf">plot_single_scatter</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">y_std</span><span class="p">,</span>
                        <span class="n">title</span><span class="p">,</span> <span class="n">x_label</span><span class="p">,</span> <span class="n">y_label</span><span class="p">,</span>
                        <span class="n">file_prefix</span><span class="p">,</span> <span class="n">folder_path</span><span class="p">,</span> <span class="n">fig_id</span><span class="p">,</span>
                        <span class="n">y_type</span><span class="o">=</span><span class="s1">&#39;linear&#39;</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">y_type</span> <span class="ow">is</span> <span class="s1">&#39;linear&#39;</span><span class="p">:</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">errorbar</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span> <span class="n">y_std</span><span class="p">,</span> <span class="n">fmt</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">,</span> <span class="n">solid_capstyle</span><span class="o">=</span><span class="s1">&#39;projecting&#39;</span><span class="p">)</span>
        <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">axline</span><span class="p">((</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="n">slope</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;dashed&#39;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="n">ymin</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">ymax</span><span class="o">=</span><span class="mi">2500</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="n">xmin</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">xmax</span><span class="o">=</span><span class="mi">2500</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">y_type</span> <span class="ow">is</span> <span class="s1">&#39;log&#39;</span><span class="p">:</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">loglog</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="s1">&#39;o&#39;</span><span class="p">)</span>
        <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="n">ymin</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="n">ymax</span><span class="o">=</span><span class="mi">2500</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="n">xmin</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="n">xmax</span><span class="o">=</span><span class="mi">2500</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">y_type</span> <span class="ow">is</span> <span class="s1">&#39;error_t1&#39;</span><span class="p">:</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">errorbar</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">calc_error</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">),</span> <span class="n">fmt</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">)</span>
        <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">axline</span><span class="p">((</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="n">slope</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">axline</span><span class="p">((</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">10</span><span class="p">),</span> <span class="n">slope</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;dashed&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">axline</span><span class="p">((</span><span class="mi">1</span><span class="p">,</span> <span class="mi">10</span><span class="p">),</span> <span class="n">slope</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;dashed&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="n">ymin</span><span class="o">=-</span><span class="mi">100</span><span class="p">,</span> <span class="n">ymax</span><span class="o">=</span><span class="mi">100</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="n">xmin</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">xmax</span><span class="o">=</span><span class="mi">2500</span><span class="p">)</span>


    
    <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="n">title</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="n">x_label</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="n">y_label</span><span class="p">)</span>

    <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">gcf</span><span class="p">()</span>
    

    <span class="n">folder_path</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">parents</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">fig_id</span><span class="o">&lt;</span><span class="mi">10</span><span class="p">:</span>
        <span class="n">filename</span> <span class="o">=</span> <span class="s2">&quot;0&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">fig_id</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;_&quot;</span> <span class="o">+</span> <span class="n">file_prefix</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">filename</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">fig_id</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;_&quot;</span> <span class="o">+</span> <span class="n">file_prefix</span>

    <span class="n">fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">folder_path</span> <span class="o">/</span> <span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;.svg&#39;</span><span class="p">),</span> <span class="n">facecolor</span><span class="o">=</span><span class="s1">&#39;white&#39;</span><span class="p">)</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">folder_path</span> <span class="o">/</span> <span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;.png&#39;</span><span class="p">),</span> <span class="n">facecolor</span><span class="o">=</span><span class="s1">&#39;white&#39;</span><span class="p">)</span>
    <span class="n">fig_id</span> <span class="o">=</span> <span class="n">fig_id</span> <span class="o">+</span> <span class="mi">1</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">fig_id</span>

<span class="c1">## Load database</span>

<span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_pickle</span><span class="p">(</span><span class="n">database_path</span><span class="p">)</span>

<span class="c1">## Initialize array</span>

<span class="n">dataset_estimate</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([])</span>
<span class="n">dataset_std</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([])</span>

<span class="n">index</span> <span class="o">=</span> <span class="mf">6.001</span>

<span class="n">serial_number</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">index</span><span class="p">][</span><span class="s1">&#39;phantom serial number&#39;</span><span class="p">]</span>


<span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">get_NIST_ids</span><span class="p">():</span>
    <span class="k">if</span> <span class="n">estimate_type</span> <span class="o">==</span> <span class="s1">&#39;mean&#39;</span><span class="p">:</span>
        <span class="n">dataset_estimate</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">dataset_estimate</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">index</span><span class="p">][</span><span class="n">key</span><span class="p">]))</span>
    <span class="k">elif</span> <span class="n">estimate_type</span> <span class="o">==</span> <span class="s1">&#39;median&#39;</span><span class="p">:</span>
        <span class="n">dataset_estimate</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">dataset_estimate</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">median</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">index</span><span class="p">][</span><span class="n">key</span><span class="p">]))</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;Unsupported dataset estimate type.&#39;</span><span class="p">)</span>

    <span class="n">dataset_std</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">dataset_std</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">index</span><span class="p">][</span><span class="n">key</span><span class="p">]))</span>

<span class="n">ref_values</span> <span class="o">=</span> <span class="n">get_reference_NIST_values</span><span class="p">(</span><span class="n">serial_number</span><span class="p">)</span>

<span class="n">temperature</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">index</span><span class="p">][</span><span class="s1">&#39;phantom temperature&#39;</span><span class="p">]</span>
<span class="n">temp_corrected_ref_values</span> <span class="o">=</span> <span class="n">temperature_correction</span><span class="p">(</span><span class="n">temperature</span><span class="p">,</span> <span class="n">serial_number</span><span class="p">)</span>


<span class="c1"># PYTHON CODE</span>
<span class="c1"># Module imports</span>

<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">from</span> <span class="nn">PIL</span> <span class="kn">import</span> <span class="n">Image</span>
<span class="kn">from</span> <span class="nn">matplotlib.image</span> <span class="kn">import</span> <span class="n">imread</span>
<span class="kn">import</span> <span class="nn">scipy.io</span>
<span class="kn">import</span> <span class="nn">plotly.graph_objs</span> <span class="k">as</span> <span class="nn">go</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">plotly</span> <span class="kn">import</span> <span class="n">__version__</span>
<span class="kn">from</span> <span class="nn">plotly.offline</span> <span class="kn">import</span> <span class="n">init_notebook_mode</span><span class="p">,</span> <span class="n">iplot</span><span class="p">,</span> <span class="n">plot</span>
<span class="n">config</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;showLink&#39;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span> <span class="s1">&#39;displayModeBar&#39;</span><span class="p">:</span> <span class="kc">False</span><span class="p">}</span>

<span class="n">init_notebook_mode</span><span class="p">(</span><span class="n">connected</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="kn">from</span> <span class="nn">IPython.display</span> <span class="kn">import</span> <span class="n">display</span><span class="p">,</span> <span class="n">HTML</span>

<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">markdown</span>
<span class="kn">import</span> <span class="nn">random</span>
<span class="kn">from</span> <span class="nn">scipy.integrate</span> <span class="kn">import</span> <span class="n">quad</span>

<span class="kn">import</span> <span class="nn">warnings</span>
<span class="n">warnings</span><span class="o">.</span><span class="n">filterwarnings</span><span class="p">(</span><span class="s1">&#39;ignore&#39;</span><span class="p">)</span>
<span class="n">config</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;showLink&#39;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span> <span class="s1">&#39;displayModeBar&#39;</span><span class="p">:</span> <span class="kc">False</span><span class="p">}</span>

<span class="n">lin_line</span> <span class="o">=</span> <span class="n">go</span><span class="o">.</span><span class="n">Scatter</span><span class="p">(</span>
    <span class="n">x</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">2500</span><span class="p">),</span>
    <span class="n">y</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">2500</span><span class="p">),</span>
    <span class="n">name</span><span class="o">=</span><span class="s2">&quot;slope&quot;</span><span class="p">,</span>
    <span class="n">line_shape</span><span class="o">=</span><span class="s1">&#39;linear&#39;</span><span class="p">,</span>
    <span class="n">line</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;dash&#39;</span><span class="p">:</span> <span class="s1">&#39;dash&#39;</span><span class="p">,</span><span class="s1">&#39;color&#39;</span><span class="p">:</span> <span class="s1">&#39;black&#39;</span><span class="p">},</span>
    <span class="n">visible</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
    <span class="n">showlegend</span> <span class="o">=</span> <span class="kc">False</span>
<span class="p">)</span>

<span class="n">data_lin</span><span class="o">=</span><span class="n">go</span><span class="o">.</span><span class="n">Scatter</span><span class="p">(</span>
    <span class="n">x</span><span class="o">=</span><span class="n">temp_corrected_ref_values</span><span class="p">,</span>
    <span class="n">y</span><span class="o">=</span><span class="n">dataset_estimate</span><span class="p">,</span>
    <span class="n">error_y</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span>
        <span class="nb">type</span><span class="o">=</span><span class="s1">&#39;data&#39;</span><span class="p">,</span> <span class="c1"># value of error bar given in data coordinates</span>
        <span class="n">array</span><span class="o">=</span><span class="n">dataset_std</span><span class="p">,</span>
        <span class="n">visible</span><span class="o">=</span><span class="kc">True</span><span class="p">),</span>
    <span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;id: &#39;</span><span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">index</span><span class="p">),</span>
    <span class="n">mode</span> <span class="o">=</span> <span class="s1">&#39;markers&#39;</span><span class="p">,</span>
    <span class="n">marker</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;#007ea7&#39;</span><span class="p">),</span>
    <span class="n">visible</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
    <span class="n">showlegend</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="p">)</span>

<span class="n">data_log</span><span class="o">=</span><span class="n">go</span><span class="o">.</span><span class="n">Scatter</span><span class="p">(</span>
    <span class="n">x</span><span class="o">=</span><span class="n">temp_corrected_ref_values</span><span class="p">,</span>
    <span class="n">y</span><span class="o">=</span><span class="n">dataset_estimate</span><span class="p">,</span>
    <span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;id: &#39;</span><span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">index</span><span class="p">),</span>
    <span class="n">mode</span> <span class="o">=</span> <span class="s1">&#39;markers&#39;</span><span class="p">,</span>
    <span class="n">marker</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;#007ea7&#39;</span><span class="p">),</span>
    <span class="n">visible</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
    <span class="n">showlegend</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="p">)</span>
<span class="n">data_error</span><span class="o">=</span><span class="n">go</span><span class="o">.</span><span class="n">Scatter</span><span class="p">(</span>
    <span class="n">x</span><span class="o">=</span><span class="n">temp_corrected_ref_values</span><span class="p">,</span>
    <span class="n">y</span><span class="o">=</span> <span class="n">calc_error</span><span class="p">(</span><span class="n">temp_corrected_ref_values</span><span class="p">,</span><span class="n">dataset_estimate</span><span class="p">),</span>
    <span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;id: &#39;</span><span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">index</span><span class="p">),</span>
    <span class="n">mode</span> <span class="o">=</span> <span class="s1">&#39;markers&#39;</span><span class="p">,</span>
    <span class="n">marker</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;#007ea7&#39;</span><span class="p">),</span>
    <span class="n">visible</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
    <span class="n">showlegend</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="p">)</span>
<span class="n">err_solid_line</span> <span class="o">=</span> <span class="n">go</span><span class="o">.</span><span class="n">Scatter</span><span class="p">(</span>
    <span class="n">x</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">2500</span><span class="p">),</span>
    <span class="n">y</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">2500</span><span class="p">)</span><span class="o">*</span><span class="mi">0</span><span class="p">,</span>
    <span class="n">name</span><span class="o">=</span><span class="s2">&quot;0 </span><span class="si">% e</span><span class="s2">rror line&quot;</span><span class="p">,</span>
    <span class="n">line_shape</span><span class="o">=</span><span class="s1">&#39;linear&#39;</span><span class="p">,</span>
    <span class="n">line</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;dash&#39;</span><span class="p">:</span> <span class="s1">&#39;solid&#39;</span><span class="p">,</span><span class="s1">&#39;color&#39;</span><span class="p">:</span> <span class="s1">&#39;black&#39;</span><span class="p">},</span>
    <span class="n">visible</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
    <span class="n">showlegend</span> <span class="o">=</span> <span class="kc">False</span>
<span class="p">)</span>
<span class="n">err_p10_line</span> <span class="o">=</span> <span class="n">go</span><span class="o">.</span><span class="n">Scatter</span><span class="p">(</span>
    <span class="n">x</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">2500</span><span class="p">),</span>
    <span class="n">y</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">2500</span><span class="p">)</span><span class="o">*</span><span class="mi">0</span><span class="o">+</span><span class="mi">10</span><span class="p">,</span>
    <span class="n">name</span><span class="o">=</span><span class="s2">&quot;+10</span><span class="si">% e</span><span class="s2">rror&quot;</span><span class="p">,</span>
    <span class="n">line_shape</span><span class="o">=</span><span class="s1">&#39;linear&#39;</span><span class="p">,</span>
    <span class="n">line</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;dash&#39;</span><span class="p">:</span> <span class="s1">&#39;dash&#39;</span><span class="p">,</span><span class="s1">&#39;color&#39;</span><span class="p">:</span> <span class="s1">&#39;black&#39;</span><span class="p">},</span>
    <span class="n">visible</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
    <span class="n">showlegend</span> <span class="o">=</span> <span class="kc">False</span>
<span class="p">)</span>
<span class="n">err_m10_line</span> <span class="o">=</span> <span class="n">go</span><span class="o">.</span><span class="n">Scatter</span><span class="p">(</span>
    <span class="n">x</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">2500</span><span class="p">),</span>
    <span class="n">y</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">2500</span><span class="p">)</span><span class="o">*</span><span class="mi">0</span><span class="o">-</span><span class="mi">10</span><span class="p">,</span>
    <span class="n">name</span><span class="o">=</span><span class="s2">&quot;-10</span><span class="si">% e</span><span class="s2">rror&quot;</span><span class="p">,</span>
    <span class="n">line_shape</span><span class="o">=</span><span class="s1">&#39;linear&#39;</span><span class="p">,</span>
    <span class="n">line</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;dash&#39;</span><span class="p">:</span> <span class="s1">&#39;dash&#39;</span><span class="p">,</span><span class="s1">&#39;color&#39;</span><span class="p">:</span> <span class="s1">&#39;black&#39;</span><span class="p">},</span>
    <span class="n">visible</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
    <span class="n">showlegend</span> <span class="o">=</span> <span class="kc">False</span>
<span class="p">)</span>

<span class="n">data</span> <span class="o">=</span> <span class="p">[</span><span class="n">lin_line</span><span class="p">,</span> <span class="n">data_lin</span><span class="p">,</span> <span class="n">data_log</span><span class="p">,</span> <span class="n">data_error</span><span class="p">,</span> <span class="n">err_solid_line</span><span class="p">,</span> <span class="n">err_p10_line</span><span class="p">,</span> <span class="n">err_m10_line</span><span class="p">]</span>

<span class="kn">from</span> <span class="nn">plotly.subplots</span> <span class="kn">import</span> <span class="n">make_subplots</span>
<span class="kn">import</span> <span class="nn">plotly.graph_objects</span> <span class="k">as</span> <span class="nn">go</span>

<span class="n">fig</span> <span class="o">=</span> <span class="n">make_subplots</span><span class="p">(</span><span class="n">rows</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">cols</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">horizontal_spacing</span> <span class="o">=</span> <span class="mf">0.08</span><span class="p">)</span>

<span class="n">fig</span><span class="o">.</span><span class="n">add_trace</span><span class="p">(</span>
    <span class="n">lin_line</span><span class="p">,</span>
    <span class="n">row</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">col</span><span class="o">=</span><span class="mi">1</span>
<span class="p">)</span>

<span class="n">fig</span><span class="o">.</span><span class="n">add_trace</span><span class="p">(</span>
    <span class="n">data_lin</span><span class="p">,</span>
    <span class="n">row</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">col</span><span class="o">=</span><span class="mi">1</span>
<span class="p">)</span>

<span class="n">fig</span><span class="o">.</span><span class="n">add_trace</span><span class="p">(</span>
    <span class="n">data_log</span><span class="p">,</span>
    <span class="n">row</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">col</span><span class="o">=</span><span class="mi">2</span>
<span class="p">)</span>

<span class="n">fig</span><span class="o">.</span><span class="n">add_trace</span><span class="p">(</span>
    <span class="n">data_error</span><span class="p">,</span>
    <span class="n">row</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">col</span><span class="o">=</span><span class="mi">3</span>
<span class="p">)</span>

<span class="n">fig</span><span class="o">.</span><span class="n">add_trace</span><span class="p">(</span>
    <span class="n">err_solid_line</span><span class="p">,</span>
    <span class="n">row</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">col</span><span class="o">=</span><span class="mi">3</span>
<span class="p">)</span>

<span class="n">fig</span><span class="o">.</span><span class="n">add_trace</span><span class="p">(</span>
    <span class="n">err_p10_line</span><span class="p">,</span>
    <span class="n">row</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">col</span><span class="o">=</span><span class="mi">3</span>
<span class="p">)</span>

<span class="n">fig</span><span class="o">.</span><span class="n">add_trace</span><span class="p">(</span>
    <span class="n">err_m10_line</span><span class="p">,</span>
    <span class="n">row</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">col</span><span class="o">=</span><span class="mi">3</span>
<span class="p">)</span>

<span class="n">output_folder</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="s2">&quot;analysis/plots/04_alldatasets_scatter_NIST-temperature-corrected/&quot;</span><span class="p">)</span>

<span class="c1">## Initialize array</span>

<span class="n">dataset_mean</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">1</span><span class="p">,</span><span class="mi">14</span><span class="p">))</span>
<span class="n">dataset_std</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">1</span><span class="p">,</span><span class="mi">14</span><span class="p">))</span>
<span class="n">version</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([])</span>
<span class="n">temperature</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([])</span>
<span class="n">ref_values</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">1</span><span class="p">,</span><span class="mi">14</span><span class="p">))</span>


<span class="n">ii</span><span class="o">=</span><span class="mi">0</span>
<span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">df</span><span class="o">.</span><span class="n">iterrows</span><span class="p">():</span>
    <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">index</span><span class="p">][</span><span class="s1">&#39;T1 - NIST sphere 1&#39;</span><span class="p">])</span> <span class="ow">is</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>

        <span class="n">version</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">version</span><span class="p">,</span><span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">index</span><span class="p">][</span><span class="s1">&#39;phantom serial number&#39;</span><span class="p">])</span>
        <span class="n">temperature</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">temperature</span><span class="p">,</span> <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">index</span><span class="p">][</span><span class="s1">&#39;phantom temperature&#39;</span><span class="p">])</span>


        <span class="k">if</span> <span class="n">version</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">version</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span> <span class="o">=</span> <span class="mi">999</span> <span class="c1"># Missing version, only known case is one where we have version &gt; 42 right now.</span>
        
        <span class="k">if</span> <span class="n">temperature</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">temperature</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span> <span class="o">=</span> <span class="mi">20</span> <span class="c1"># Missing temperature, assume it to be 20C (reference temperature).</span>
            
            
        <span class="k">if</span> <span class="n">ii</span><span class="o">==</span><span class="mi">0</span><span class="p">:</span>
            <span class="n">ref_values</span> <span class="o">=</span> <span class="n">get_reference_NIST_values</span><span class="p">(</span><span class="n">version</span><span class="p">[</span><span class="n">ii</span><span class="p">])</span>
            <span class="n">temp_corrected_ref_values</span> <span class="o">=</span> <span class="n">temperature_correction</span><span class="p">(</span><span class="n">temperature</span><span class="p">[</span><span class="n">ii</span><span class="p">],</span> <span class="n">version</span><span class="p">[</span><span class="n">ii</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">ref_values</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">((</span><span class="n">ref_values</span><span class="p">,</span> <span class="n">get_reference_NIST_values</span><span class="p">(</span><span class="n">version</span><span class="p">[</span><span class="n">ii</span><span class="p">])))</span>
            <span class="n">temp_corrected_ref_values</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">((</span><span class="n">temp_corrected_ref_values</span><span class="p">,</span> <span class="n">temperature_correction</span><span class="p">(</span><span class="n">temperature</span><span class="p">[</span><span class="n">ii</span><span class="p">],</span> <span class="n">version</span><span class="p">[</span><span class="n">ii</span><span class="p">])))</span>
        
        <span class="n">tmp_dataset_estimate</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([])</span>
        <span class="n">tmp_dataset_std</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([])</span>

        <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">get_NIST_ids</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">estimate_type</span> <span class="ow">is</span> <span class="s1">&#39;mean&#39;</span><span class="p">:</span>
                <span class="n">tmp_dataset_estimate</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">tmp_dataset_estimate</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">index</span><span class="p">][</span><span class="n">key</span><span class="p">]))</span>
            <span class="k">elif</span> <span class="n">estimate_type</span> <span class="ow">is</span> <span class="s1">&#39;median&#39;</span><span class="p">:</span>
                <span class="n">tmp_dataset_estimate</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">tmp_dataset_estimate</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">median</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">index</span><span class="p">][</span><span class="n">key</span><span class="p">]))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;Unsupported dataset estimate type.&#39;</span><span class="p">)</span>

            <span class="n">tmp_dataset_std</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">tmp_dataset_std</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">index</span><span class="p">][</span><span class="n">key</span><span class="p">]))</span>

        <span class="k">if</span> <span class="n">ii</span><span class="o">==</span><span class="mi">0</span><span class="p">:</span>
            <span class="n">dataset_estimate</span> <span class="o">=</span> <span class="n">tmp_dataset_estimate</span>  
            <span class="n">dataset_std</span> <span class="o">=</span> <span class="n">tmp_dataset_std</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">dataset_estimate</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">((</span><span class="n">dataset_estimate</span><span class="p">,</span> <span class="n">tmp_dataset_estimate</span><span class="p">))</span>
            <span class="n">dataset_std</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">((</span><span class="n">dataset_std</span><span class="p">,</span> <span class="n">tmp_dataset_std</span><span class="p">))</span>

        <span class="n">ii</span><span class="o">=</span><span class="n">ii</span><span class="o">+</span><span class="mi">1</span>

<span class="c1">## Setup for plots</span>
<span class="n">fig_id</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">dims</span><span class="o">=</span><span class="n">ref_values</span><span class="o">.</span><span class="n">shape</span>
<span class="n">file_prefix</span> <span class="o">=</span> <span class="s1">&#39;alldatasets&#39;</span>

<span class="n">fig</span><span class="o">.</span><span class="n">add_trace</span><span class="p">(</span>
    <span class="n">lin_line</span><span class="p">,</span>
    <span class="n">row</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">col</span><span class="o">=</span><span class="mi">1</span>
<span class="p">)</span>

<span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">dims</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
    <span class="n">data_lin</span><span class="o">=</span><span class="n">go</span><span class="o">.</span><span class="n">Scatter</span><span class="p">(</span>
        <span class="n">x</span><span class="o">=</span><span class="n">temp_corrected_ref_values</span><span class="p">[</span><span class="n">ii</span><span class="p">,:],</span>
        <span class="n">y</span><span class="o">=</span><span class="n">dataset_estimate</span><span class="p">[</span><span class="n">ii</span><span class="p">,:],</span>
        <span class="n">error_y</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span>
            <span class="nb">type</span><span class="o">=</span><span class="s1">&#39;data&#39;</span><span class="p">,</span> <span class="c1"># value of error bar given in data coordinates</span>
            <span class="n">array</span><span class="o">=</span><span class="n">dataset_std</span><span class="p">[</span><span class="n">ii</span><span class="p">,:],</span>
            <span class="n">visible</span><span class="o">=</span><span class="kc">True</span><span class="p">),</span>
        <span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;id: &#39;</span><span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="n">ii</span><span class="p">]),</span>
        <span class="n">mode</span> <span class="o">=</span> <span class="s1">&#39;markers&#39;</span><span class="p">,</span>
        <span class="n">visible</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
        <span class="n">showlegend</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="n">fig</span><span class="o">.</span><span class="n">add_trace</span><span class="p">(</span>
        <span class="n">data_lin</span><span class="p">,</span>
        <span class="n">row</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">col</span><span class="o">=</span><span class="mi">1</span>
    <span class="p">)</span>


<span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">dims</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
    <span class="n">data_log</span><span class="o">=</span><span class="n">go</span><span class="o">.</span><span class="n">Scatter</span><span class="p">(</span>
        <span class="n">x</span><span class="o">=</span><span class="n">temp_corrected_ref_values</span><span class="p">[</span><span class="n">ii</span><span class="p">,:],</span>
        <span class="n">y</span><span class="o">=</span><span class="n">dataset_estimate</span><span class="p">[</span><span class="n">ii</span><span class="p">,:],</span>
        <span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;id: &#39;</span><span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="n">ii</span><span class="p">]),</span>
        <span class="n">mode</span> <span class="o">=</span> <span class="s1">&#39;markers&#39;</span><span class="p">,</span>
        <span class="n">visible</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
        <span class="n">showlegend</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="p">)</span>

    <span class="n">fig</span><span class="o">.</span><span class="n">add_trace</span><span class="p">(</span>
        <span class="n">data_log</span><span class="p">,</span>
        <span class="n">row</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">col</span><span class="o">=</span><span class="mi">2</span>
    <span class="p">)</span>

<span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">dims</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
    <span class="n">data_error</span><span class="o">=</span><span class="n">go</span><span class="o">.</span><span class="n">Scatter</span><span class="p">(</span>
        <span class="n">x</span><span class="o">=</span><span class="n">temp_corrected_ref_values</span><span class="p">[</span><span class="n">ii</span><span class="p">,:],</span>
        <span class="n">y</span><span class="o">=</span> <span class="n">calc_error</span><span class="p">(</span><span class="n">temp_corrected_ref_values</span><span class="p">[</span><span class="n">ii</span><span class="p">,:],</span><span class="n">dataset_estimate</span><span class="p">[</span><span class="n">ii</span><span class="p">,:]),</span>
        <span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;id: &#39;</span><span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="n">ii</span><span class="p">]),</span>
        <span class="n">mode</span> <span class="o">=</span> <span class="s1">&#39;markers&#39;</span><span class="p">,</span>
        <span class="n">visible</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
        <span class="n">showlegend</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="p">)</span>

    <span class="n">fig</span><span class="o">.</span><span class="n">add_trace</span><span class="p">(</span>
        <span class="n">data_error</span><span class="p">,</span>
        <span class="n">row</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">col</span><span class="o">=</span><span class="mi">3</span>
    <span class="p">)</span>

<span class="n">fig</span><span class="o">.</span><span class="n">add_trace</span><span class="p">(</span>
    <span class="n">err_solid_line</span><span class="p">,</span>
    <span class="n">row</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">col</span><span class="o">=</span><span class="mi">3</span>
<span class="p">)</span>

<span class="n">fig</span><span class="o">.</span><span class="n">add_trace</span><span class="p">(</span>
    <span class="n">err_p10_line</span><span class="p">,</span>
    <span class="n">row</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">col</span><span class="o">=</span><span class="mi">3</span>
<span class="p">)</span>

<span class="n">fig</span><span class="o">.</span><span class="n">add_trace</span><span class="p">(</span>
    <span class="n">err_m10_line</span><span class="p">,</span>
    <span class="n">row</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">col</span><span class="o">=</span><span class="mi">3</span>
<span class="p">)</span>

<span class="n">fig</span><span class="o">.</span><span class="n">update_xaxes</span><span class="p">(</span>
    <span class="nb">type</span><span class="o">=</span><span class="s2">&quot;linear&quot;</span><span class="p">,</span>
    <span class="nb">range</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">2500</span><span class="p">],</span>
    <span class="n">title</span><span class="o">=</span><span class="s1">&#39;Reference T&lt;sub&gt;1&lt;/sub&gt; (ms)&#39;</span><span class="p">,</span>
    <span class="n">showgrid</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">gridcolor</span><span class="o">=</span><span class="s1">&#39;rgb(169,169,169)&#39;</span><span class="p">,</span>
    <span class="n">tick0</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
    <span class="n">dtick</span> <span class="o">=</span> <span class="mi">500</span><span class="p">,</span>
    <span class="n">linecolor</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">,</span>
    <span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
    <span class="n">row</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">col</span><span class="o">=</span><span class="mi">1</span>
    <span class="p">)</span>
<span class="n">fig</span><span class="o">.</span><span class="n">update_yaxes</span><span class="p">(</span>
    <span class="nb">type</span><span class="o">=</span><span class="s2">&quot;linear&quot;</span><span class="p">,</span>
    <span class="nb">range</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">2500</span><span class="p">],</span>
    <span class="n">title</span><span class="o">=</span><span class="p">{</span>
        <span class="s1">&#39;text&#39;</span><span class="p">:</span><span class="s1">&#39;T&lt;sub&gt;1&lt;/sub&gt; estimate (ms)&#39;</span><span class="p">,</span>
        <span class="s1">&#39;standoff&#39;</span><span class="p">:</span><span class="mi">0</span>
        <span class="p">},</span>
    <span class="n">showgrid</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">tick0</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
    <span class="n">dtick</span> <span class="o">=</span> <span class="mi">500</span><span class="p">,</span>
    <span class="n">gridcolor</span><span class="o">=</span><span class="s1">&#39;rgb(169,169,169)&#39;</span><span class="p">,</span>
    <span class="n">linecolor</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">,</span>
    <span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
    <span class="n">row</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">col</span><span class="o">=</span><span class="mi">1</span>
    <span class="p">)</span>

<span class="n">fig</span><span class="o">.</span><span class="n">update_xaxes</span><span class="p">(</span>
    <span class="nb">type</span><span class="o">=</span><span class="s2">&quot;log&quot;</span><span class="p">,</span>
    <span class="nb">range</span><span class="o">=</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="mi">20</span><span class="p">),</span><span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="mi">2500</span><span class="p">)],</span>
    <span class="n">title</span><span class="o">=</span><span class="s1">&#39;Reference T&lt;sub&gt;1&lt;/sub&gt; (ms)&#39;</span><span class="p">,</span>
    <span class="n">showgrid</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">gridcolor</span><span class="o">=</span><span class="s1">&#39;rgb(169,169,169)&#39;</span><span class="p">,</span>
    <span class="n">minor</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">ticks</span><span class="o">=</span><span class="s2">&quot;inside&quot;</span><span class="p">,</span> <span class="n">ticklen</span><span class="o">=</span><span class="mi">6</span><span class="p">,</span> <span class="n">showgrid</span><span class="o">=</span><span class="kc">True</span><span class="p">),</span>
    <span class="n">linecolor</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">,</span>
    <span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
    <span class="n">row</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">col</span><span class="o">=</span><span class="mi">2</span>
    <span class="p">)</span>
<span class="n">fig</span><span class="o">.</span><span class="n">update_yaxes</span><span class="p">(</span>
    <span class="nb">type</span><span class="o">=</span><span class="s2">&quot;log&quot;</span><span class="p">,</span>
    <span class="nb">range</span><span class="o">=</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="mi">20</span><span class="p">),</span><span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="mi">2500</span><span class="p">)],</span>
    <span class="n">title</span><span class="o">=</span><span class="p">{</span>
        <span class="s1">&#39;text&#39;</span><span class="p">:</span><span class="s1">&#39;T&lt;sub&gt;1&lt;/sub&gt; estimate (ms)&#39;</span><span class="p">,</span>
        <span class="s1">&#39;standoff&#39;</span><span class="p">:</span><span class="mi">0</span>
        <span class="p">},</span>
    <span class="n">showgrid</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">gridcolor</span><span class="o">=</span><span class="s1">&#39;rgb(169,169,169)&#39;</span><span class="p">,</span>
    <span class="n">minor</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">ticks</span><span class="o">=</span><span class="s2">&quot;inside&quot;</span><span class="p">,</span> <span class="n">ticklen</span><span class="o">=</span><span class="mi">6</span><span class="p">,</span> <span class="n">showgrid</span><span class="o">=</span><span class="kc">True</span><span class="p">),</span>
    <span class="n">linecolor</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">,</span>
    <span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
    <span class="n">row</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">col</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>

<span class="n">fig</span><span class="o">.</span><span class="n">update_xaxes</span><span class="p">(</span>
    <span class="nb">type</span><span class="o">=</span><span class="s2">&quot;linear&quot;</span><span class="p">,</span>
    <span class="nb">range</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">2500</span><span class="p">],</span>
    <span class="n">title</span><span class="o">=</span><span class="s1">&#39;Reference T&lt;sub&gt;1&lt;/sub&gt; (ms)&#39;</span><span class="p">,</span>
    <span class="n">showgrid</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">gridcolor</span><span class="o">=</span><span class="s1">&#39;rgb(169,169,169)&#39;</span><span class="p">,</span>
    <span class="n">tick0</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
    <span class="n">dtick</span> <span class="o">=</span> <span class="mi">500</span><span class="p">,</span>
    <span class="n">linecolor</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">,</span>
    <span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
    <span class="n">row</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">col</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>

<span class="n">fig</span><span class="o">.</span><span class="n">update_yaxes</span><span class="p">(</span>
    <span class="nb">type</span><span class="o">=</span><span class="s2">&quot;linear&quot;</span><span class="p">,</span>
    <span class="nb">range</span><span class="o">=</span><span class="p">[</span><span class="o">-</span><span class="mi">100</span><span class="p">,</span><span class="mi">100</span><span class="p">],</span>
    <span class="n">title</span><span class="o">=</span><span class="p">{</span>
        <span class="s1">&#39;text&#39;</span><span class="p">:</span><span class="s1">&#39;Error (%)&#39;</span><span class="p">,</span>
        <span class="s1">&#39;standoff&#39;</span><span class="p">:</span><span class="mi">0</span>
        <span class="p">},</span>
    <span class="n">showgrid</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">gridcolor</span><span class="o">=</span><span class="s1">&#39;rgb(169,169,169)&#39;</span><span class="p">,</span>
    <span class="n">tick0</span> <span class="o">=</span> <span class="o">-</span><span class="mi">100</span><span class="p">,</span>
    <span class="n">dtick</span> <span class="o">=</span> <span class="mi">25</span><span class="p">,</span>
    <span class="n">linecolor</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">,</span>
    <span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
    <span class="n">row</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">col</span><span class="o">=</span><span class="mi">3</span>
    <span class="p">)</span>


<span class="n">fig</span><span class="o">.</span><span class="n">update_xaxes</span><span class="p">(</span>
    <span class="nb">type</span><span class="o">=</span><span class="s2">&quot;linear&quot;</span><span class="p">,</span>
    <span class="nb">range</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">2500</span><span class="p">],</span>
    <span class="n">title</span><span class="o">=</span><span class="s1">&#39;Reference T&lt;sub&gt;1&lt;/sub&gt; (ms)&#39;</span><span class="p">,</span>
    <span class="n">showgrid</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">gridcolor</span><span class="o">=</span><span class="s1">&#39;rgb(169,169,169)&#39;</span><span class="p">,</span>
    <span class="n">tick0</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
    <span class="n">dtick</span> <span class="o">=</span> <span class="mi">500</span><span class="p">,</span>
    <span class="n">linecolor</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">,</span>
    <span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
    <span class="n">row</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">col</span><span class="o">=</span><span class="mi">1</span>
    <span class="p">)</span>
<span class="n">fig</span><span class="o">.</span><span class="n">update_yaxes</span><span class="p">(</span>
    <span class="nb">type</span><span class="o">=</span><span class="s2">&quot;linear&quot;</span><span class="p">,</span>
    <span class="nb">range</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">2500</span><span class="p">],</span>
    <span class="n">title</span><span class="o">=</span><span class="p">{</span>
        <span class="s1">&#39;text&#39;</span><span class="p">:</span><span class="s1">&#39;T&lt;sub&gt;1&lt;/sub&gt; estimate (ms)&#39;</span><span class="p">,</span>
        <span class="s1">&#39;standoff&#39;</span><span class="p">:</span><span class="mi">0</span>
        <span class="p">},</span>
    <span class="n">showgrid</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">gridcolor</span><span class="o">=</span><span class="s1">&#39;rgb(169,169,169)&#39;</span><span class="p">,</span>
    <span class="n">tick0</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
    <span class="n">dtick</span> <span class="o">=</span> <span class="mi">500</span><span class="p">,</span>
    <span class="n">linecolor</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">,</span>
    <span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
    <span class="n">row</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">col</span><span class="o">=</span><span class="mi">1</span>
    <span class="p">)</span>

<span class="n">fig</span><span class="o">.</span><span class="n">update_xaxes</span><span class="p">(</span>
    <span class="nb">type</span><span class="o">=</span><span class="s2">&quot;log&quot;</span><span class="p">,</span>
    <span class="nb">range</span><span class="o">=</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="mi">20</span><span class="p">),</span><span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="mi">2500</span><span class="p">)],</span>
    <span class="n">title</span><span class="o">=</span><span class="s1">&#39;Reference T&lt;sub&gt;1&lt;/sub&gt; (ms)&#39;</span><span class="p">,</span>
    <span class="n">showgrid</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">gridcolor</span><span class="o">=</span><span class="s1">&#39;rgb(169,169,169)&#39;</span><span class="p">,</span>
    <span class="n">minor</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">ticks</span><span class="o">=</span><span class="s2">&quot;inside&quot;</span><span class="p">,</span> <span class="n">ticklen</span><span class="o">=</span><span class="mi">6</span><span class="p">,</span> <span class="n">showgrid</span><span class="o">=</span><span class="kc">True</span><span class="p">),</span>
    <span class="n">linecolor</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">,</span>
    <span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
    <span class="n">row</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">col</span><span class="o">=</span><span class="mi">2</span>
    <span class="p">)</span>
<span class="n">fig</span><span class="o">.</span><span class="n">update_yaxes</span><span class="p">(</span>
    <span class="nb">type</span><span class="o">=</span><span class="s2">&quot;log&quot;</span><span class="p">,</span>
    <span class="nb">range</span><span class="o">=</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="mi">20</span><span class="p">),</span><span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="mi">2500</span><span class="p">)],</span>
    <span class="n">title</span><span class="o">=</span><span class="p">{</span>
        <span class="s1">&#39;text&#39;</span><span class="p">:</span><span class="s1">&#39;T&lt;sub&gt;1&lt;/sub&gt; estimate (ms)&#39;</span><span class="p">,</span>
        <span class="s1">&#39;standoff&#39;</span><span class="p">:</span><span class="mi">0</span>
        <span class="p">},</span>
    <span class="n">showgrid</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">gridcolor</span><span class="o">=</span><span class="s1">&#39;rgb(169,169,169)&#39;</span><span class="p">,</span>
    <span class="n">minor</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">ticks</span><span class="o">=</span><span class="s2">&quot;inside&quot;</span><span class="p">,</span> <span class="n">ticklen</span><span class="o">=</span><span class="mi">6</span><span class="p">,</span> <span class="n">showgrid</span><span class="o">=</span><span class="kc">True</span><span class="p">),</span>
    <span class="n">linecolor</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">,</span>
    <span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
    <span class="n">row</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">col</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>

<span class="n">fig</span><span class="o">.</span><span class="n">update_xaxes</span><span class="p">(</span>
    <span class="nb">type</span><span class="o">=</span><span class="s2">&quot;linear&quot;</span><span class="p">,</span>
    <span class="nb">range</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">2500</span><span class="p">],</span>
    <span class="n">title</span><span class="o">=</span><span class="s1">&#39;Reference T&lt;sub&gt;1&lt;/sub&gt; (ms)&#39;</span><span class="p">,</span>
    <span class="n">showgrid</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">gridcolor</span><span class="o">=</span><span class="s1">&#39;rgb(169,169,169)&#39;</span><span class="p">,</span>
    <span class="n">tick0</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
    <span class="n">dtick</span> <span class="o">=</span> <span class="mi">500</span><span class="p">,</span>
    <span class="n">linecolor</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">,</span>
    <span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
    <span class="n">row</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">col</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>

<span class="n">fig</span><span class="o">.</span><span class="n">update_yaxes</span><span class="p">(</span>
    <span class="nb">type</span><span class="o">=</span><span class="s2">&quot;linear&quot;</span><span class="p">,</span>
    <span class="nb">range</span><span class="o">=</span><span class="p">[</span><span class="o">-</span><span class="mi">100</span><span class="p">,</span><span class="mi">100</span><span class="p">],</span>
    <span class="n">title</span><span class="o">=</span><span class="p">{</span>
        <span class="s1">&#39;text&#39;</span><span class="p">:</span><span class="s1">&#39;Error (%)&#39;</span><span class="p">,</span>
        <span class="s1">&#39;standoff&#39;</span><span class="p">:</span><span class="mi">0</span>
        <span class="p">},</span>
    <span class="n">showgrid</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">gridcolor</span><span class="o">=</span><span class="s1">&#39;rgb(169,169,169)&#39;</span><span class="p">,</span>
    <span class="n">tick0</span> <span class="o">=</span> <span class="o">-</span><span class="mi">100</span><span class="p">,</span>
    <span class="n">dtick</span> <span class="o">=</span> <span class="mi">25</span><span class="p">,</span>
    <span class="n">linecolor</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">,</span>
    <span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
    <span class="n">row</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">col</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span>
    <span class="p">)</span>

<span class="n">fig</span><span class="o">.</span><span class="n">update_layout</span><span class="p">(</span>
    <span class="n">margin</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">l</span><span class="o">=</span><span class="mi">30</span><span class="p">,</span> <span class="n">r</span><span class="o">=</span><span class="mi">30</span><span class="p">,</span> <span class="n">t</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">b</span><span class="o">=</span><span class="mi">30</span><span class="p">),</span>
    <span class="n">paper_bgcolor</span><span class="o">=</span><span class="s1">&#39;rgb(255, 255, 255)&#39;</span><span class="p">,</span>
    <span class="n">plot_bgcolor</span><span class="o">=</span><span class="s1">&#39;rgb(255, 255, 255)&#39;</span><span class="p">,</span>
    <span class="n">legend_title</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span>
    <span class="n">annotations</span><span class="o">=</span><span class="p">[</span>
        <span class="nb">dict</span><span class="p">(</span>
            <span class="n">x</span><span class="o">=-</span><span class="mf">0.05</span><span class="p">,</span>
            <span class="n">y</span><span class="o">=</span><span class="mf">0.53</span><span class="p">,</span>
            <span class="n">showarrow</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
            <span class="n">text</span><span class="o">=</span><span class="s1">&#39;&lt;b&gt;a&lt;/b&gt;&#39;</span><span class="p">,</span>
            <span class="n">font</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span>
                <span class="n">family</span><span class="o">=</span><span class="s1">&#39;Times New Roman&#39;</span><span class="p">,</span>
                <span class="n">size</span><span class="o">=</span><span class="mi">48</span>
            <span class="p">),</span>
            <span class="n">xref</span><span class="o">=</span><span class="s1">&#39;paper&#39;</span><span class="p">,</span>
            <span class="n">yref</span><span class="o">=</span><span class="s1">&#39;paper&#39;</span>
        <span class="p">),</span>
        <span class="nb">dict</span><span class="p">(</span>
            <span class="n">x</span><span class="o">=</span><span class="mf">0.32</span><span class="p">,</span>
            <span class="n">y</span><span class="o">=</span><span class="mf">0.53</span><span class="p">,</span>
            <span class="n">showarrow</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
            <span class="n">text</span><span class="o">=</span><span class="s1">&#39;&lt;b&gt;b&lt;/b&gt;&#39;</span><span class="p">,</span>
            <span class="n">font</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span>
                <span class="n">family</span><span class="o">=</span><span class="s1">&#39;Times New Roman&#39;</span><span class="p">,</span>
                <span class="n">size</span><span class="o">=</span><span class="mi">48</span>
            <span class="p">),</span>
            <span class="n">xref</span><span class="o">=</span><span class="s1">&#39;paper&#39;</span><span class="p">,</span>
            <span class="n">yref</span><span class="o">=</span><span class="s1">&#39;paper&#39;</span>
        <span class="p">),</span>
        <span class="nb">dict</span><span class="p">(</span>
            <span class="n">x</span><span class="o">=</span><span class="mf">0.7</span><span class="p">,</span>
            <span class="n">y</span><span class="o">=</span><span class="mf">0.53</span><span class="p">,</span>
            <span class="n">showarrow</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
            <span class="n">text</span><span class="o">=</span><span class="s1">&#39;&lt;b&gt;c&lt;/b&gt;&#39;</span><span class="p">,</span>
            <span class="n">font</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span>
                <span class="n">family</span><span class="o">=</span><span class="s1">&#39;Times New Roman&#39;</span><span class="p">,</span>
                <span class="n">size</span><span class="o">=</span><span class="mi">48</span>
            <span class="p">),</span>
            <span class="n">xref</span><span class="o">=</span><span class="s1">&#39;paper&#39;</span><span class="p">,</span>
            <span class="n">yref</span><span class="o">=</span><span class="s1">&#39;paper&#39;</span>
        <span class="p">),</span>
        <span class="nb">dict</span><span class="p">(</span>
            <span class="n">x</span><span class="o">=-</span><span class="mf">0.05</span><span class="p">,</span>
            <span class="n">y</span><span class="o">=-</span><span class="mf">0.11</span><span class="p">,</span>
            <span class="n">showarrow</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
            <span class="n">text</span><span class="o">=</span><span class="s1">&#39;&lt;b&gt;d&lt;/b&gt;&#39;</span><span class="p">,</span>
            <span class="n">font</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span>
                <span class="n">family</span><span class="o">=</span><span class="s1">&#39;Times New Roman&#39;</span><span class="p">,</span>
                <span class="n">size</span><span class="o">=</span><span class="mi">48</span>
            <span class="p">),</span>
            <span class="n">xref</span><span class="o">=</span><span class="s1">&#39;paper&#39;</span><span class="p">,</span>
            <span class="n">yref</span><span class="o">=</span><span class="s1">&#39;paper&#39;</span>
        <span class="p">),</span>
        <span class="nb">dict</span><span class="p">(</span>
            <span class="n">x</span><span class="o">=</span><span class="mf">0.32</span><span class="p">,</span>
            <span class="n">y</span><span class="o">=-</span><span class="mf">0.11</span><span class="p">,</span>
            <span class="n">showarrow</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
            <span class="n">text</span><span class="o">=</span><span class="s1">&#39;&lt;b&gt;e&lt;/b&gt;&#39;</span><span class="p">,</span>
            <span class="n">font</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span>
                <span class="n">family</span><span class="o">=</span><span class="s1">&#39;Times New Roman&#39;</span><span class="p">,</span>
                <span class="n">size</span><span class="o">=</span><span class="mi">48</span>
            <span class="p">),</span>
            <span class="n">xref</span><span class="o">=</span><span class="s1">&#39;paper&#39;</span><span class="p">,</span>
            <span class="n">yref</span><span class="o">=</span><span class="s1">&#39;paper&#39;</span>
        <span class="p">),</span>
        <span class="nb">dict</span><span class="p">(</span>
            <span class="n">x</span><span class="o">=</span><span class="mf">0.7</span><span class="p">,</span>
            <span class="n">y</span><span class="o">=-</span><span class="mf">0.11</span><span class="p">,</span>
            <span class="n">showarrow</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
            <span class="n">text</span><span class="o">=</span><span class="s1">&#39;&lt;b&gt;f&lt;/b&gt;&#39;</span><span class="p">,</span>
            <span class="n">font</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span>
                <span class="n">family</span><span class="o">=</span><span class="s1">&#39;Times New Roman&#39;</span><span class="p">,</span>
                <span class="n">size</span><span class="o">=</span><span class="mi">48</span>
            <span class="p">),</span>
            <span class="n">xref</span><span class="o">=</span><span class="s1">&#39;paper&#39;</span><span class="p">,</span>
            <span class="n">yref</span><span class="o">=</span><span class="s1">&#39;paper&#39;</span>
        <span class="p">),</span>
        <span class="p">]</span>
    <span class="p">)</span>

<span class="n">fig</span><span class="o">.</span><span class="n">update_layout</span><span class="p">(</span><span class="n">height</span><span class="o">=</span><span class="mi">600</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mi">960</span><span class="p">)</span>

<span class="c1">#iplot(fig, filename = &#39;figure3&#39;, config = config)</span>
<span class="n">plot</span><span class="p">(</span><span class="n">fig</span><span class="p">,</span> <span class="n">filename</span> <span class="o">=</span> <span class="s1">&#39;figure3.html&#39;</span><span class="p">,</span> <span class="n">config</span> <span class="o">=</span> <span class="n">config</span><span class="p">)</span>
<span class="n">display</span><span class="p">(</span><span class="n">HTML</span><span class="p">(</span><span class="s1">&#39;figure3.html&#39;</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><script type="text/javascript">
window.PlotlyConfig = {MathJaxConfig: 'local'};
if (window.MathJax && window.MathJax.Hub && window.MathJax.Hub.Config) {window.MathJax.Hub.Config({SVG: {font: "STIX-Web"}});}
if (typeof require !== 'undefined') {
require.undef("plotly");
requirejs.config({
    paths: {
        'plotly': ['https://cdn.plot.ly/plotly-2.20.0.min']
    }
});
require(['plotly'], function(Plotly) {
    window._Plotly = Plotly;
});
}
</script>
</div><div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">NameError</span><span class="g g-Whitespace">                                 </span>Traceback (most recent call last)
<span class="n">Cell</span> <span class="n">In</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">line</span> <span class="mi">30</span>
<span class="g g-Whitespace">     </span><span class="mi">27</span> <span class="n">yAxis</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">256</span><span class="o">*</span><span class="mi">2</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">num</span><span class="o">=</span><span class="mi">256</span><span class="o">*</span><span class="mi">2</span><span class="p">)</span>
<span class="g g-Whitespace">     </span><span class="mi">29</span> <span class="c1"># T1 maps</span>
<span class="ne">---&gt; </span><span class="mi">30</span> <span class="n">im_2_padded</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">pad</span><span class="p">(</span><span class="n">im_2</span><span class="p">,</span><span class="mi">32</span><span class="p">)</span>
<span class="g g-Whitespace">     </span><span class="mi">31</span> <span class="n">images_1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">im_1</span><span class="p">,</span> <span class="n">im_5</span><span class="p">,</span> <span class="n">im_3</span><span class="p">),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="g g-Whitespace">     </span><span class="mi">32</span> <span class="n">images_2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">im_4</span><span class="p">,</span> <span class="n">im_2_padded</span><span class="p">,</span> <span class="n">im_6</span><span class="p">),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

<span class="ne">NameError</span>: name &#39;im_2&#39; is not defined
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># PYTHON CODE</span>
<span class="c1"># Module imports</span>

<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">from</span> <span class="nn">PIL</span> <span class="kn">import</span> <span class="n">Image</span>
<span class="kn">from</span> <span class="nn">matplotlib.image</span> <span class="kn">import</span> <span class="n">imread</span>
<span class="kn">import</span> <span class="nn">scipy.io</span>
<span class="kn">import</span> <span class="nn">plotly.graph_objs</span> <span class="k">as</span> <span class="nn">go</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">plotly</span> <span class="kn">import</span> <span class="n">__version__</span>
<span class="kn">from</span> <span class="nn">plotly.offline</span> <span class="kn">import</span> <span class="n">init_notebook_mode</span><span class="p">,</span> <span class="n">iplot</span><span class="p">,</span> <span class="n">plot</span>
<span class="n">config</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;showLink&#39;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span> <span class="s1">&#39;displayModeBar&#39;</span><span class="p">:</span> <span class="kc">False</span><span class="p">}</span>

<span class="n">init_notebook_mode</span><span class="p">(</span><span class="n">connected</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="kn">from</span> <span class="nn">IPython.display</span> <span class="kn">import</span> <span class="n">display</span><span class="p">,</span> <span class="n">HTML</span>

<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">markdown</span>
<span class="kn">import</span> <span class="nn">random</span>
<span class="kn">from</span> <span class="nn">scipy.integrate</span> <span class="kn">import</span> <span class="n">quad</span>

<span class="kn">import</span> <span class="nn">warnings</span>
<span class="n">warnings</span><span class="o">.</span><span class="n">filterwarnings</span><span class="p">(</span><span class="s1">&#39;ignore&#39;</span><span class="p">)</span>
<span class="n">config</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;showLink&#39;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span> <span class="s1">&#39;displayModeBar&#39;</span><span class="p">:</span> <span class="kc">False</span><span class="p">}</span>

<span class="n">data_wm</span><span class="o">=</span><span class="n">go</span><span class="o">.</span><span class="n">Scatter</span><span class="p">(</span>
    <span class="n">x</span><span class="o">=</span><span class="n">x3</span><span class="p">,</span>
    <span class="n">y</span><span class="o">=</span><span class="n">genu_estimate</span><span class="p">,</span>
    <span class="n">error_y</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span>
        <span class="nb">type</span><span class="o">=</span><span class="s1">&#39;data&#39;</span><span class="p">,</span> <span class="c1"># value of error bar given in data coordinates</span>
        <span class="n">array</span><span class="o">=</span><span class="n">genu_std</span><span class="p">,</span>
        <span class="n">visible</span><span class="o">=</span><span class="kc">True</span><span class="p">),</span>
    <span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;White matter (one 5x5 ROI, ~genu)&#39;</span><span class="p">,</span>
    <span class="n">mode</span> <span class="o">=</span> <span class="s1">&#39;markers&#39;</span><span class="p">,</span>
    <span class="n">marker</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;#007ea7&#39;</span><span class="p">),</span>
    <span class="n">visible</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
    <span class="n">showlegend</span> <span class="o">=</span> <span class="kc">False</span>

    <span class="p">)</span>

<span class="n">data_gm</span><span class="o">=</span><span class="n">go</span><span class="o">.</span><span class="n">Scatter</span><span class="p">(</span>
    <span class="n">x</span><span class="o">=</span><span class="n">x3</span><span class="p">,</span>
    <span class="n">y</span><span class="o">=</span><span class="n">cgm_estimate</span><span class="p">,</span>
    <span class="n">error_y</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span>
        <span class="nb">type</span><span class="o">=</span><span class="s1">&#39;data&#39;</span><span class="p">,</span> <span class="c1"># value of error bar given in data coordinates</span>
        <span class="n">array</span><span class="o">=</span><span class="n">cgm_std</span><span class="p">,</span>
        <span class="n">visible</span><span class="o">=</span><span class="kc">True</span><span class="p">),</span>
    <span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;Grey matter (three 3x3 ROIs, cortex)&#39;</span><span class="p">,</span>
    <span class="n">mode</span> <span class="o">=</span> <span class="s1">&#39;markers&#39;</span><span class="p">,</span>
    <span class="n">marker</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;#D22B2B&#39;</span><span class="p">),</span>
    <span class="n">visible</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
    <span class="n">showlegend</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="p">)</span>


<span class="n">data</span> <span class="o">=</span> <span class="p">[</span><span class="n">data_wm</span><span class="p">,</span> <span class="n">data_gm</span><span class="p">]</span>


<span class="n">layout</span> <span class="o">=</span> <span class="n">go</span><span class="o">.</span><span class="n">Layout</span><span class="p">(</span>
    <span class="n">width</span><span class="o">=</span><span class="mi">960</span><span class="p">,</span>
    <span class="n">height</span><span class="o">=</span><span class="mi">250</span><span class="p">,</span>
    <span class="n">margin</span><span class="o">=</span><span class="n">go</span><span class="o">.</span><span class="n">layout</span><span class="o">.</span><span class="n">Margin</span><span class="p">(</span>
        <span class="n">l</span><span class="o">=</span><span class="mi">80</span><span class="p">,</span>
        <span class="n">r</span><span class="o">=</span><span class="mi">40</span><span class="p">,</span>
        <span class="n">b</span><span class="o">=</span><span class="mi">80</span><span class="p">,</span>
        <span class="n">t</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span>
    <span class="p">),</span>
    <span class="n">xaxis_title</span><span class="o">=</span><span class="s1">&#39;Site #.Meas #&#39;</span><span class="p">,</span>
    <span class="n">yaxis_title</span><span class="o">=</span><span class="s1">&#39;T&lt;sub&gt;1&lt;/sub&gt; (ms)&#39;</span><span class="p">,</span>
    <span class="n">font</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span>
        <span class="n">family</span><span class="o">=</span><span class="s1">&#39;Times New Roman&#39;</span><span class="p">,</span>
        <span class="n">size</span><span class="o">=</span><span class="mi">22</span>
    <span class="p">),</span>
    <span class="n">xaxis</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span>
        <span class="n">autorange</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="nb">range</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">57</span><span class="p">],</span>
        <span class="n">showgrid</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">linecolor</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">,</span>
        <span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
        <span class="n">tickangle</span> <span class="o">=</span> <span class="o">-</span><span class="mi">90</span><span class="p">,</span>
        <span class="n">tickmode</span><span class="o">=</span><span class="s1">&#39;linear&#39;</span><span class="p">,</span>
        <span class="n">tickfont</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span>
            <span class="n">family</span><span class="o">=</span><span class="s1">&#39;Times New Roman&#39;</span><span class="p">,</span>
            <span class="n">size</span><span class="o">=</span><span class="mi">12</span><span class="p">,</span>
        <span class="p">),</span>
    <span class="p">),</span>
    <span class="n">yaxis</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span>
        <span class="n">autorange</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="nb">range</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2999</span><span class="p">],</span>
        <span class="n">showgrid</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">dtick</span><span class="o">=</span><span class="mi">500</span><span class="p">,</span>
        <span class="n">gridcolor</span><span class="o">=</span><span class="s1">&#39;rgb(169,169,169)&#39;</span><span class="p">,</span>
        <span class="n">linecolor</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">,</span>
        <span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
        <span class="n">tickfont</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span>
            <span class="n">family</span><span class="o">=</span><span class="s1">&#39;Times New Roman&#39;</span><span class="p">,</span>
            <span class="n">size</span><span class="o">=</span><span class="mi">18</span><span class="p">,</span>
        <span class="p">),</span>
    <span class="p">),</span>
    <span class="n">annotations</span><span class="o">=</span><span class="p">[</span>
        <span class="nb">dict</span><span class="p">(</span>
            <span class="n">x</span><span class="o">=-</span><span class="mf">0.1</span><span class="p">,</span>
            <span class="n">y</span><span class="o">=-</span><span class="mf">0.5</span><span class="p">,</span>
            <span class="n">showarrow</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
            <span class="n">text</span><span class="o">=</span><span class="s1">&#39;&lt;b&gt;b&lt;/b&gt;&#39;</span><span class="p">,</span>
            <span class="n">font</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span>
                <span class="n">family</span><span class="o">=</span><span class="s1">&#39;Times New Roman&#39;</span><span class="p">,</span>
                <span class="n">size</span><span class="o">=</span><span class="mi">64</span>
            <span class="p">),</span>
            <span class="n">xref</span><span class="o">=</span><span class="s1">&#39;paper&#39;</span><span class="p">,</span>
            <span class="n">yref</span><span class="o">=</span><span class="s1">&#39;paper&#39;</span>
        <span class="p">),</span>
    <span class="p">],</span>
    <span class="n">paper_bgcolor</span><span class="o">=</span><span class="s1">&#39;rgb(255, 255, 255)&#39;</span><span class="p">,</span>
    <span class="n">plot_bgcolor</span><span class="o">=</span><span class="s1">&#39;rgb(255, 255, 255)&#39;</span><span class="p">,</span>
<span class="p">)</span>

<span class="n">fig</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">,</span> <span class="n">layout</span><span class="o">=</span><span class="n">layout</span><span class="p">)</span>

<span class="c1">#iplot(fig, filename = &#39;figure6b&#39;, config = config)</span>
<span class="n">plot</span><span class="p">(</span><span class="n">fig</span><span class="p">,</span> <span class="n">filename</span> <span class="o">=</span> <span class="s1">&#39;figure6b.html&#39;</span><span class="p">,</span> <span class="n">config</span> <span class="o">=</span> <span class="n">config</span><span class="p">)</span>
<span class="n">display</span><span class="p">(</span><span class="n">HTML</span><span class="p">(</span><span class="s1">&#39;figure6b.html&#39;</span><span class="p">))</span>
</pre></div>
</div>
</div>
</div>
<p class="caption">
<b>Figure 4</b> Measured mean T1 values vs. temperature-corrected NIST reference values of the phantom spheres are presented as linear plots (a), log-log plots (b), and plots of the error relative to reference T1 value (c). The dashed lines in plots (c) represent a ±10 % error. Mean T1 values in two sets of ROIs, white matter (one 5⨯5 voxel ROI, genu) and gray matter (three 3⨯3 voxel ROIs, cortex). Top figure shows all datasets collapsed into sites, whereas the bottom shows each individual dataset. In subplot g), the missing datapoint for deep GM in 10.001 was due to the slice positioning of the acquisition not containing deep GM. Interactive figure available at: https://preprint.neurolibre.org/10.55458/neurolibre.00014/.
</p><div class="section" id="discussion">
<h2>4     |     DISCUSSION<a class="headerlink" href="#discussion" title="Permalink to this headline">#</a></h2>
<p>The challenge focused on exploring if different research groups could reproduce T1 maps based on the protocol information reported in a published PDF [31]. Eighteen submissions independently implemented the inversion recovery T1 mapping acquisition protocol as outlined in Barral et al. [31], and reported T1 mapping data in a standard quantitative MRI phantom and/or human brains at 27 MRI sites, using systems from three different vendors (GE, Philips, Siemens). The collaborative effort produced an open-source database of 94 T1 mapping datasets, including 38 ISMRM/NIST phantom and 56 human brain datasets. The inter-submission variability was twice as high as the intra-submission variability in both phantom and human brain T1 measurements, <strong>demonstrating that a PDF is not enough for reproducibility in quantitative MRI.</strong></p>
<p>More information is needed to unify all the aspects of a pulse sequence across sites. However, in a vendor-native setting, this is a major challenge given the disparities between proprietary development libraries [41]. Vendor-neutral pulse sequence design platforms [42–44] have emerged as a powerful solution to standardize sequence components at the implementation level. Vendor neutrality has been shown to significantly reduce the variability of T1 maps acquired using VFA across vendors [44]. In the absence of a vendor-neutral framework, a vendor-native alternative is the implementation of a strategy to control the saturation of MT across TRs [45]. Nevertheless, this approach can still benefit from a vendor-neutral approach to enhance accessibility and unify implementations. This is because vendor-specific constraints are recognized to impose limitations on the adaptability of sequences, resulting in significant variability even when implementations are closely aligned within their respective vendor-native development environments [46].</p>
<p>The 2020 Reproducibility Challenge, jointly organized by the Reproducible Research and Quantitative MR ISMRM study groups, led to the creation of a large open database of standard quantitative MR phantom and human brain inversion recovery T1 maps. These maps were measured using independently implemented imaging protocols on MRI scanners from three different manufacturers. All collected data, processing pipeline code, computational environment files, and analysis scripts were shared with the goal of promoting reproducible research practices, and an interactive dashboard was developed to broaden the accessibility and engagement of the resulting datasets (<a class="reference external" href="https://rrsg2020.dashboards.neurolibre.org">https://rrsg2020.dashboards.neurolibre.org</a>). The differences in stability between independently implemented (inter-submission) and centrally shared (intra-submission) protocols observed both in phantoms and in vivo could help inform future meta-analyses of quantitative MRI metrics [47,48] and better guide multi-center collaborations.</p>
</div>
</div>
<div class="tex2jax_ignore mathjax_ignore section" id="acknowledgement">
<h1>ACKNOWLEDGEMENT<a class="headerlink" href="#acknowledgement" title="Permalink to this headline">#</a></h1>
<p style="text-align:justify;">
The conception of this collaborative reproducibility challenge originated from discussions with experts, including Paul Tofts, Joëlle Barral, and Ilana Leppert, who provided valuable insights. Additionally, Kathryn Keenan, Zydrunas Gimbutas, and Andrew Dienstfrey from NIST provided their code to generate the ROI template for the ISMRM/NIST phantom. Dylan Roskams-Edris and Gabriel Pelletier from the Tanenbaum Open Science Institute (TOSI) offered valuable insights and guidance related to data ethics and data sharing in the context of this international multi-center conference challenge. The 2020 RRSG study group committee members who launched the challenge, Martin Uecker, Florian Knoll, Nikola Stikov, Maria Eugenia Caligiuri, and Daniel Gallichan, as well as the 2020 qMRSG committee members, Kathryn Keenan, Diego Hernando, Xavier Golay, Annie Yuxin Zhang, and Jeff Gunter, also played an essential role in making this challenge possible. We’d also like to extend our thanks to all the volunteers and individuals who helped with the scanning at each imaging site.
The authors thank the ISMRM Reproducible Research Study Group for conducting a code review of the code (Version 1) supplied in the Data Availability Statement. The scope of the code review covered only the code’s ease of download, quality of documentation, and ability to run, but did not consider scientific accuracy or code efficiency.
<p>Lastly, we acknowledge use of ChatGPT (v3), a generative language model, for accelerating manuscript preparation. The co-first authors employed ChatGPT in the initial draft for transforming bullet point sentences into paragraphs, proofreading for typos, and refining the academic tone. ChatGPT served exclusively as a writing aid, and was not used to create or interpret results.</p>
</p>
</div>
<div class="tex2jax_ignore mathjax_ignore section" id="data-availability-statement">
<h1>DATA AVAILABILITY STATEMENT<a class="headerlink" href="#data-availability-statement" title="Permalink to this headline">#</a></h1>
<p>An interactive NeuroLibre preprint of this manuscript is available at <a class="reference external" href="https://preprint.neurolibre.org/10.55458/neurolibre.00014/">https://preprint.neurolibre.org/10.55458/neurolibre.00014/</a>. All imaging data submitted to the challenge, dataset details, registered ROI maps, and processed T1 maps are hosted on OSF <a class="reference external" href="https://osf.io/ywc9g/">https://osf.io/ywc9g/</a>. The dataset submissions and quality assurance were handled through GitHub issues in this repository <a class="reference external" href="https://github.com/rrsg2020/data_submission">https://github.com/rrsg2020/data_submission</a> (commit: 9d7eff1). Note that accepted submissions are closed issues, and that the GitHub branches associated with the issue numbers contain the Dockerfile and Jupyter Notebook scripts that reproduce these preliminary quality assurance results and can be run in a browser using MyBinder. The ROI registration scripts for the phantoms and T1 fitting pipeline to process all datasets are hosted in this GitHub repository, <a class="reference external" href="https://github.com/rrsg2020/t1_fitting_pipeline">https://github.com/rrsg2020/t1_fitting_pipeline</a> (commit: 3497a4e). All the analyses of the datasets were done using Jupyter Notebooks and are available in this repository, <a class="reference external" href="https://github.com/rrsg2020/analysis">https://github.com/rrsg2020/analysis</a> (commit: 8d38644), which also contains a Dockerfile to reproduce the environment using a tool like MyBinder. A dashboard was developed to explore the datasets information and results in a browser, which is accessible here, <a class="reference external" href="https://rrsg2020.dashboards.neurolibre.org">https://rrsg2020.dashboards.neurolibre.org</a>, and the code is also available on GitHub: <a class="reference external" href="https://github.com/rrsg2020/rrsg2020-dashboard">https://github.com/rrsg2020/rrsg2020-dashboard</a> (commit: 6ee9321).</p>
</div>
<div class="tex2jax_ignore mathjax_ignore section" id="references">
<h1>References<a class="headerlink" href="#references" title="Permalink to this headline">#</a></h1>
<ol>
<li><p>Keenan KE, Biller JR, Delfino JG, Boss MA, Does MD, Evelhoch JL, et al. Recommendations towards standards for quantitative MRI (qMRI) and outstanding needs. J Magn Reson Imaging. 2019;49: e26–e39.</p></li>
<li><p>Fryback DG, Thornbury JR. The efficacy of diagnostic imaging. Med Decis Making. 1991;11: 88–94.</p></li>
<li><p>Schweitzer M. Stages of technical efficacy: Journal of Magnetic Resonance Imaging style. J Magn Reson Imaging. 2016;44: 781–782.</p></li>
<li><p>Seiberlich N, Gulani V, Campbell A, Sourbron S, Doneva MI, Calamante F, et al. Quantitative Magnetic Resonance Imaging. Academic Press; 2020.</p></li>
<li><p>Damadian R. Tumor detection by nuclear magnetic resonance. Science. 1971;171: 1151–1153.</p></li>
<li><p>Pykett IL, Mansfield P. A line scan image study of a tumorous rat leg by NMR. Phys Med Biol. 1978;23: 961–967.</p></li>
<li><p>Stikov N, Boudreau M, Levesque IR, Tardif CL, Barral JK, Pike GB. On the accuracy of T1 mapping: Searching for common ground. Magn Reson Med. 2015;73: 514–522.</p></li>
<li><p>Boudreau M, Keenan KE, Stikov N. Quantitative T1 and T1r Mapping. Quantitative Magnetic Resonance Imaging. 2020. pp. 19–45.</p></li>
<li><p>Bottomley PA, Foster TH, Argersinger RE, Pfeifer LM. A review of normal tissue hydrogen NMR relaxation times and relaxation mechanisms from 1-100 MHz: dependence on tissue type, NMR frequency, temperature, species, excision, and age. Med Phys. 1984;11: 425–448.</p></li>
<li><div class="highlight-none notranslate"><div class="highlight"><pre><span></span>Wansapura JP, Holland SK, Dunn RS, Ball WS Jr. NMR relaxation times in the human brain at 3.0 tesla. J Magn Reson Imaging. 1999;9: 531–538.
</pre></div>
</div>
</li>
<li><div class="highlight-none notranslate"><div class="highlight"><pre><span></span>Dieringer MA, Deimling M, Santoro D, Wuerfel J, Madai VI, Sobesky J, et al. Rapid parametric mapping of the longitudinal relaxation time T1 using two-dimensional variable flip angle magnetic resonance imaging at 1.5 Tesla, 3 Tesla, and 7 Tesla. PLoS One. 2014;9: e91318.
</pre></div>
</div>
</li>
<li><div class="highlight-none notranslate"><div class="highlight"><pre><span></span>Ernst RR, Anderson WA. Application of Fourier Transform Spectroscopy to Magnetic Resonance. Rev Sci Instrum. 1966;37: 93–102.
</pre></div>
</div>
</li>
<li><div class="highlight-none notranslate"><div class="highlight"><pre><span></span>Redpath TW, Smith FW. Technical note: use of a double inversion recovery pulse sequence to image selectively grey or white brain matter. Br J Radiol. 1994;67: 1258–1263.
</pre></div>
</div>
</li>
<li><div class="highlight-none notranslate"><div class="highlight"><pre><span></span>Tofts PS. Modeling tracer kinetics in dynamic Gd-DTPA MR imaging. J Magn Reson Imaging. 1997;7: 91–101.
</pre></div>
</div>
</li>
<li><div class="highlight-none notranslate"><div class="highlight"><pre><span></span>Sled JG, Pike GB. Quantitative imaging of magnetization transfer exchange and relaxation properties in vivo using MRI. Magn Reson Med. 2001;46: 923–931.
</pre></div>
</div>
</li>
<li><div class="highlight-none notranslate"><div class="highlight"><pre><span></span>Yuan J, Chow SKK, Yeung DKW, Ahuja AT, King AD. Quantitative evaluation of dual-flip-angle T1 mapping on DCE-MRI kinetic parameter estimation in head and neck. Quant Imaging Med Surg. 2012;2: 245–253.
</pre></div>
</div>
</li>
<li><div class="highlight-none notranslate"><div class="highlight"><pre><span></span>Drain LE. A Direct Method of Measuring Nuclear Spin-Lattice Relaxation Times. Proc Phys Soc A. 1949;62: 301.
</pre></div>
</div>
</li>
<li><div class="highlight-none notranslate"><div class="highlight"><pre><span></span>Hahn EL. An Accurate Nuclear Magnetic Resonance Method for Measuring Spin-Lattice Relaxation Times. Physical Review. 1949. pp. 145–146. doi:10.1103/physrev.76.145
</pre></div>
</div>
</li>
<li><div class="highlight-none notranslate"><div class="highlight"><pre><span></span>Fram EK, Herfkens RJ, Johnson GA, Glover GH, Karis JP, Shimakawa A, et al. Rapid calculation of T1 using variable flip angle gradient refocused imaging. Magn Reson Imaging. 1987;5: 201–208.
</pre></div>
</div>
</li>
<li><div class="highlight-none notranslate"><div class="highlight"><pre><span></span>Deoni SCL, Rutt BK, Peters TM. Rapid combinedT1 andT2 mapping using gradient recalled acquisition in the steady state. Magnetic Resonance in Medicine. 2003. pp. 515–526. doi:10.1002/mrm.10407
</pre></div>
</div>
</li>
<li><div class="highlight-none notranslate"><div class="highlight"><pre><span></span>Cheng H-LM, Wright GA. Rapid high-resolutionT1 mapping by variable flip angles: Accurate and precise measurements in the presence of radiofrequency field inhomogeneity. Magnetic Resonance in Medicine. 2006. pp. 566–574. doi:10.1002/mrm.20791
</pre></div>
</div>
</li>
<li><div class="highlight-none notranslate"><div class="highlight"><pre><span></span>Look DC, Locker DR. Time saving in measurement of NMR and EPR relaxation times. Rev Sci Instrum. 1970;41: 250–251.
</pre></div>
</div>
</li>
<li><div class="highlight-none notranslate"><div class="highlight"><pre><span></span>Messroghli DR, Radjenovic A, Kozerke S, Higgins DM, Sivananthan MU, Ridgway JP. Modified Look-Locker inversion recovery (MOLLI) for high-resolution T1 mapping of the heart. Magn Reson Med. 2004;52: 141–146.
</pre></div>
</div>
</li>
<li><div class="highlight-none notranslate"><div class="highlight"><pre><span></span>Piechnik SK, Ferreira VM, Dall’Armellina E, Cochlin LE, Greiser A, Neubauer S, et al. Shortened Modified Look-Locker Inversion recovery (ShMOLLI) for clinical myocardial T1-mapping at 1.5 and 3 T within a 9 heartbeat breathhold. J Cardiovasc Magn Reson. 2010;12: 69.
</pre></div>
</div>
</li>
<li><div class="highlight-none notranslate"><div class="highlight"><pre><span></span>Marques JP, Kober T, Krueger G, van der Zwaag W, Van de Moortele P-F, Gruetter R. MP2RAGE, a self bias-field corrected sequence for improved segmentation and T1-mapping at high field. NeuroImage. 2010. pp. 1271–1281. doi:10.1016/j.neuroimage.2009.10.002
</pre></div>
</div>
</li>
<li><div class="highlight-none notranslate"><div class="highlight"><pre><span></span>Marques JP, Gruetter R. New developments and applications of the MP2RAGE sequence--focusing the contrast and high spatial resolution R1 mapping. PLoS One. 2013;8: e69294.
</pre></div>
</div>
</li>
<li><div class="highlight-none notranslate"><div class="highlight"><pre><span></span>Keenan KE, Ainslie M, Barker AJ, Boss MA, Cecil KM, Charles C, et al. Quantitative magnetic resonance imaging phantoms: A review and the need for a system phantom. Magn Reson Med. 2018;79: 48–61.
</pre></div>
</div>
</li>
<li><div class="highlight-none notranslate"><div class="highlight"><pre><span></span>Stupic KF, Ainslie M, Boss MA, Charles C, Dienstfrey AM, Evelhoch JL, et al. A standard system phantom for magnetic resonance imaging. Magn Reson Med. 2021;86: 1194–1211.
</pre></div>
</div>
</li>
<li><div class="highlight-none notranslate"><div class="highlight"><pre><span></span>Bane O, Hectors SJ, Wagner M, Arlinghaus LL, Aryal MP, Cao Y, et al. Accuracy, repeatability, and interplatform reproducibility of T1 quantification methods used for DCE-MRI: Results from a multicenter phantom study. Magn Reson Med. 2018;79: 2564–2575.
</pre></div>
</div>
</li>
<li><div class="highlight-none notranslate"><div class="highlight"><pre><span></span>Keenan KE, Gimbutas Z, Dienstfrey A, Stupic KF, Boss MA, Russek SE, et al. Multi-site, multi-platform comparison of MRI T1 measurement using the system phantom. PLoS One. 2021;16: e0252966.
</pre></div>
</div>
</li>
<li><div class="highlight-none notranslate"><div class="highlight"><pre><span></span>Barral JK, Gudmundson E, Stikov N, Etezadi-Amoli M, Stoica P, Nishimura DG. A robust methodology for in vivo T1 mapping. Magn Reson Med. 2010;64: 1057–1067.
</pre></div>
</div>
</li>
<li><div class="highlight-none notranslate"><div class="highlight"><pre><span></span>Kluyver T, Ragan-Kelley B, Granger B, Bussonnier M, Frederic J, Kelley K, et al. Jupyter Notebooks – a publishing format for reproducible computational workflows. Positioning and Power in Academic Publishing: Players, Agents and Agendas. Amsterdam, NY: IOS Press; 2016. pp. 87–90.
</pre></div>
</div>
</li>
<li><div class="highlight-none notranslate"><div class="highlight"><pre><span></span>Beg, Taka, Kluyver, Konovalov, Ragan-Kelley, Thiery, et al. Using Jupyter for Reproducible Scientific Workflows. https://www.computer.org › csdl › magazine › 2021/02https://www.computer.org › csdl › magazine › 2021/02. 2021;23: 36–46.
</pre></div>
</div>
</li>
<li><div class="highlight-none notranslate"><div class="highlight"><pre><span></span>Karakuzu A, Boudreau M, Duval T, Boshkovski T, Leppert I, Cabana J-F, et al. qMRLab: Quantitative MRI analysis, under one umbrella. J Open Source Softw. 2020;5: 2343.
</pre></div>
</div>
</li>
<li><div class="highlight-none notranslate"><div class="highlight"><pre><span></span>Cabana J-F, Gu Y, Boudreau M, Levesque IR, Atchia Y, Sled JG, et al. Quantitative magnetization transfer imagingmadeeasy with qMTLab: Software for data simulation, analysis, and visualization. Concepts Magn Reson Part A Bridg Educ Res. 2015;44A: 263–277.
</pre></div>
</div>
</li>
<li><div class="highlight-none notranslate"><div class="highlight"><pre><span></span>Avants BB, Tustison N, Song G. Advanced normalization tools (ANTS). Insight J. 2009;2: 1–35.
</pre></div>
</div>
</li>
<li><div class="highlight-none notranslate"><div class="highlight"><pre><span></span>McCarthy P. FSLeyes. 2019. doi:10.5281/zenodo.3403671
</pre></div>
</div>
</li>
<li><div class="highlight-none notranslate"><div class="highlight"><pre><span></span>Merkel D. Docker: Lightweight Linux containers for consistent development and deployment. 2014 [cited 14 Feb 2023]. Available: https://www.seltzer.com/margo/teaching/CS508.19/papers/merkel14.pdf
</pre></div>
</div>
</li>
<li><div class="highlight-none notranslate"><div class="highlight"><pre><span></span>Boettiger C. An introduction to Docker for reproducible research. Oper Syst Rev. 2015;49: 71–79.
</pre></div>
</div>
</li>
<li><div class="highlight-none notranslate"><div class="highlight"><pre><span></span>Project Jupyter, Bussonnier M, Forde J, Freeman J, Granger B, Head T, et al. Binder 2.0 - Reproducible, interactive, sharable environments for science at scale. Proceedings of the Python in Science Conference. SciPy; 2018. doi:10.25080/majora-4af1f417-011
</pre></div>
</div>
</li>
<li><div class="highlight-none notranslate"><div class="highlight"><pre><span></span>Gracien, Maiworm, Brüche, Shrestha. How stable is quantitative MRI?–Assessment of intra-and inter-scanner-model reproducibility using identical acquisition sequences and data analysis …. Neuroimage. 2020. Available: https://www.sciencedirect.com/science/article/pii/S1053811919309553
</pre></div>
</div>
</li>
<li><div class="highlight-none notranslate"><div class="highlight"><pre><span></span>Layton KJ, Kroboth S, Jia F, Littin S, Yu H, Leupold J, et al. Pulseq: A rapid and hardware-independent pulse sequence prototyping framework. Magn Reson Med. 2017;77: 1544–1552.
</pre></div>
</div>
</li>
<li><div class="highlight-none notranslate"><div class="highlight"><pre><span></span>Cordes C, Konstandin S, Porter D, Günther M. Portable and platform-independent MR pulse sequence programs. Magn Reson Med. 2020;83: 1277–1290.
</pre></div>
</div>
</li>
<li><div class="highlight-none notranslate"><div class="highlight"><pre><span></span>Karakuzu A, Biswas L, Cohen-Adad J, Stikov N. Vendor-neutral sequences and fully transparent workflows improve inter-vendor reproducibility of quantitative MRI. Magn Reson Med. 2022;88: 1212–1228.
</pre></div>
</div>
</li>
<li><div class="highlight-none notranslate"><div class="highlight"><pre><span></span>A G Teixeira RP, Neji R, Wood TC, Baburamani AA, Malik SJ, Hajnal JV. Controlled saturation magnetization transfer for reproducible multivendor variable flip angle T1 and T2 mapping. Magn Reson Med. 2020;84: 221–236.
</pre></div>
</div>
</li>
<li><div class="highlight-none notranslate"><div class="highlight"><pre><span></span>Lee Y, Callaghan MF, Acosta-Cabronero J, Lutti A, Nagy Z. Establishing intra- and inter-vendor reproducibility of T1 relaxation time measurements with 3T MRI. Magn Reson Med. 2019;81: 454–465.
</pre></div>
</div>
</li>
<li><div class="highlight-none notranslate"><div class="highlight"><pre><span></span>Mancini M, Karakuzu A, Cohen-Adad J, Cercignani M, Nichols TE, Stikov N. An interactive meta-analysis of MRI biomarkers of myelin. Elife. 2020;9. doi:10.7554/eLife.61523
</pre></div>
</div>
</li>
<li><div class="highlight-none notranslate"><div class="highlight"><pre><span></span>Lazari A, Lipp I. Can MRI measure myelin? Systematic review, qualitative assessment, and meta-analysis of studies validating microstructural imaging with myelin histology. Neuroimage. 2021;230: 117744.
</pre></div>
</div>
</li>
</ol>
</div>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            kernelName: "python3",
            path: "./."
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

              </div>
              
            </main>
            <footer class="footer-article noprint">
                
    <!-- Previous / next buttons -->
<div class='prev-next-area'>
</div>
            </footer>
        </div>
    </div>
    <div class="footer-content row">
        <footer class="col footer"><p>
  
    By The Jupyter Book community<br/>
  
      &copy; Copyright 2022.<br/>
</p>
        </footer>
    </div>
    
</div>


      </div>
    </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf"></script>


  </body>
</html>